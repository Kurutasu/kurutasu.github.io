<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Memotaro</title>
    <description>I'm haltaro, a data scientist at an advertising agency in Tokyo, Japan. I love machine learning, marketing science, network engineering and shiba-inu:)</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 12 Oct 2018 22:08:59 +0900</pubDate>
    <lastBuildDate>Fri, 12 Oct 2018 22:08:59 +0900</lastBuildDate>
    <generator>Jekyll v3.7.3</generator>
    
      <item>
        <title>時間制約付き巡回セールスマン問題について調査した</title>
        <description>&lt;p&gt;時間制約付き巡回セールスマン問題（TSP-TW: Traveling Salesman Problem with Time Window constraint）について調査した．TSP-TWは，各点の訪問時間に制約のある巡回セールスマン問題（TSP: Traveling Salesman Problem）で，NP困難に属する．時間帯指定のある宅配業者の経路最適化など，実応用が期待される研究分野である．&lt;/p&gt;

&lt;p&gt;近似解法としては，アントコロニー法を始めとするメタヒューリスティクスが提案されている．厳密解法としては，整数線形計画問題による定式化が提案されている．&lt;/p&gt;

&lt;h1 id=&quot;巡回セールスマン問題&quot;&gt;巡回セールスマン問題&lt;/h1&gt;

&lt;p&gt;まず，TSP-TWのベースとなる，TSPについてまとめる．&lt;/p&gt;

&lt;h2 id=&quot;定義&quot;&gt;定義&lt;/h2&gt;

&lt;p&gt;TSPは，&lt;script type=&quot;math/tex&quot;&gt;n&lt;/script&gt;個のノードを一度ずつ訪れて最初のノードに戻ってくる&lt;sup id=&quot;fnref:open&quot;&gt;&lt;a href=&quot;#fn:open&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;，最短の巡回路を求める問題である．対称TSP（任意の二ノード間の距離が対称）の場合，巡回路の総数は&lt;script type=&quot;math/tex&quot;&gt;\frac{(n-1)!}{2}&lt;/script&gt;であり，ノード数が30以上になると最適解を求めるのは現実的に困難である．&lt;/p&gt;

&lt;h2 id=&quot;厳密解法&quot;&gt;厳密解法&lt;/h2&gt;

&lt;p&gt;TSPを整数計画問題として定式化すれば，小規模な問題であれば厳密解を求められる．定式化のバリエーションとして，以下の三種類を見つけた&lt;sup id=&quot;fnref:formulation&quot;&gt;&lt;a href=&quot;#fn:formulation&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;ので，それぞれ紹介する．なお，以下では簡単のため無向グラフ&lt;script type=&quot;math/tex&quot;&gt;G=(V, E)&lt;/script&gt;，つまり対称TSPを想定するが，それぞれ容易に非対称TSPに拡張可能である．&lt;/p&gt;

&lt;h3 id=&quot;接続行列を用いた定式化&quot;&gt;接続行列を用いた定式化&lt;/h3&gt;

&lt;p&gt;まずは，&lt;a href=&quot;http://amzn.asia/d/am1lVUK&quot;&gt;参考文献[1]&lt;/a&gt;で紹介されていたもの．&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\begin{align}
\mathrm{Minimize:} &amp; \mathbf{c}^{T}\mathbf{x} &amp; \tag{1.1}\\
\mathrm{Subject~to:} &amp; \mathbf{A}\mathbf{x} = \mathbf{2} &amp; \tag{1.2}\\
&amp; \sum_{e \in E(W)} x(e) \leq |W| - 1, &amp;W \subset V, W \neq \emptyset \tag{1.3}\\
&amp; x(e) = \{0, 1\}, &amp;e \in E \tag{1.4}
\end{align} %]]&gt;&lt;/script&gt;

&lt;p&gt;ただし，&lt;script type=&quot;math/tex&quot;&gt;e \in E&lt;/script&gt;はエッジ，&lt;script type=&quot;math/tex&quot;&gt;\mathbf{c} \in \mathbb{R}^{\mid E \mid}&lt;/script&gt;は各要素&lt;script type=&quot;math/tex&quot;&gt;c(e)&lt;/script&gt;がエッジ&lt;script type=&quot;math/tex&quot;&gt;e&lt;/script&gt;の距離に対応する所与のベクトル，&lt;script type=&quot;math/tex&quot;&gt;\mathbf{A} \in \mathbb{R}^{\mid V \mid \times \mid E \mid}&lt;/script&gt;は所与の接続行列である．ここで接続行列&lt;script type=&quot;math/tex&quot;&gt;\mathbf{A}&lt;/script&gt;の各行はノード&lt;script type=&quot;math/tex&quot;&gt;v \in V&lt;/script&gt;に，各列はエッジ&lt;script type=&quot;math/tex&quot;&gt;e \in E&lt;/script&gt;に対応しており，ノード&lt;script type=&quot;math/tex&quot;&gt;v&lt;/script&gt;がエッジ&lt;script type=&quot;math/tex&quot;&gt;e&lt;/script&gt;の端点なら&lt;script type=&quot;math/tex&quot;&gt;A_{ve}=1&lt;/script&gt;，そうでなければ&lt;script type=&quot;math/tex&quot;&gt;A_{ve}=0&lt;/script&gt;となる．&lt;script type=&quot;math/tex&quot;&gt;\mathbf{x} \in \mathbb{R}^{\mid E \mid}&lt;/script&gt;は各要素&lt;script type=&quot;math/tex&quot;&gt;x(e)&lt;/script&gt;がエッジ&lt;script type=&quot;math/tex&quot;&gt;e&lt;/script&gt;が巡回路に含まれるかどうかを表す変数であり，TSPではこれを最適化する．&lt;/p&gt;

&lt;p&gt;式(1.3)は部分巡回路除去制約と呼ばれ，全点を通らない部分的な巡回路を防ぐためのものである．&lt;/p&gt;

&lt;h3 id=&quot;距離行列を用いた定式化&quot;&gt;距離行列を用いた定式化&lt;/h3&gt;

&lt;p&gt;次に，&lt;a href=&quot;https://qiita.com/panchovie/items/6509fb54e3d53f4766aa&quot;&gt;参考文献[2]&lt;/a&gt;で紹介されていたもの．&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\begin{align}
\mathrm{Minimize:} &amp; \sum_{ij}c_{ij}x_{ij} &amp; \tag{2.1}\\
\mathrm{Subject~to:} &amp; \sum_{j}x_{ij} = 1, &amp; i \in V \tag{2.2}\\
&amp; \sum_{i}x_{ij} = 1, &amp; j \in V \tag{2.3}\\
&amp; u_i + 1 - M (1 - x_{ij}) \leq u_j, &amp; i, j \in V \tag{2.4}\\
&amp; 1 \leq u_i \leq |V| -1, &amp; i \in V \tag{2.5}\\
&amp; x_{ij} \in \{0, 1\}, &amp; i, j \in V \tag{2.6}
\end{align} %]]&gt;&lt;/script&gt;

&lt;p&gt;ただし，&lt;script type=&quot;math/tex&quot;&gt;i, j \in V&lt;/script&gt;はノード，&lt;script type=&quot;math/tex&quot;&gt;c_{ij} \in \mathbb{R}&lt;/script&gt;はノード&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;-&lt;script type=&quot;math/tex&quot;&gt;j&lt;/script&gt;間の所与の距離，&lt;script type=&quot;math/tex&quot;&gt;M&lt;/script&gt;は十分大きな数であれば何でも良い．また，&lt;script type=&quot;math/tex&quot;&gt;x_{ij} \in \mathbb{R}&lt;/script&gt;はノード&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;-&lt;script type=&quot;math/tex&quot;&gt;j&lt;/script&gt;間を結ぶエッジが巡回路に含まれるかどうかを表す変数，&lt;script type=&quot;math/tex&quot;&gt;u_{i} \in \mathbb{R}&lt;/script&gt;はノード&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;の訪問順序を表す変数であり，TSPではこれらを最適化する．&lt;/p&gt;

&lt;p&gt;式(2.4)は，式(1.3)と同様に部分巡回路を除去するための制約式であり，ポテンシャル制約と呼ばれる．&lt;/p&gt;

&lt;h3 id=&quot;到着時刻を用いた定式化&quot;&gt;到着時刻を用いた定式化&lt;/h3&gt;

&lt;p&gt;最後に，&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S2212567115009260&quot;&gt;参考文献[3]&lt;/a&gt;で提案されていた，TSP-TW向けの定式化から，時間帯制約を抜いて単純化したもの&lt;sup id=&quot;fnref:revise&quot;&gt;&lt;a href=&quot;#fn:revise&quot; class=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;．&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\begin{align}
\mathrm{Minimize:~} &amp; x_{n+1} \tag{3.1}\\
\mathrm{Subject~to:~} &amp; x_{i} \geq t_{0i}, &amp; i \in \{1, 2, \dots , n\} \tag{3.2} \\
&amp; x_{n+1} - x_{i} \geq t_{i0}, &amp; i \in \{1, 2, \dots , n\} \tag{3.3} \\
&amp; x_{i} - x_{j} \geq t_{ij} - My_{ij}, &amp; i,j \in \{1, 2, \dots , n\} \tag{3.4} \\
&amp; x_{j} - x_{i} \geq t_{ij} - M(1-y_{ij}), &amp; i,j \in \{1, 2, \dots , n\} \tag{3.5} \\
&amp; y_{ij} \in \{0, 1 \}, &amp; i,j \in \{1, 2, \dots , n\} \tag{3.6} \\

\end{align} %]]&gt;&lt;/script&gt;

&lt;p&gt;ここで，&lt;script type=&quot;math/tex&quot;&gt;i, j \in V&lt;/script&gt;はノードのインデックス，&lt;script type=&quot;math/tex&quot;&gt;n&lt;/script&gt;は始点と終点を除いたノード数，&lt;script type=&quot;math/tex&quot;&gt;t_{ij} \in \mathbb{R}&lt;/script&gt;はノード&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;-&lt;script type=&quot;math/tex&quot;&gt;j&lt;/script&gt;間の所与の移動時間，&lt;script type=&quot;math/tex&quot;&gt;M&lt;/script&gt;は十分大きな数であれば何でも良い．また，&lt;script type=&quot;math/tex&quot;&gt;x_{i} \in \mathbb{R}&lt;/script&gt;はノード&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;への到着時刻を表す変数，&lt;script type=&quot;math/tex&quot;&gt;y_{ij} \in \mathbb{R}&lt;/script&gt;はダミー変数であり，TSPではこれらを最適化する．&lt;/p&gt;

&lt;p&gt;式(3.4)および式(3.5)は，以下の非線形制約条件を無理やり線形化したものである．&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\left| x_{i} - x_{j} \right| \geq t_{ij}, ~~ i \in \{2, 3, \dots , n\}, 1 \leq j &lt; j %]]&gt;&lt;/script&gt;

&lt;h2 id=&quot;近似解法&quot;&gt;近似解法&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://amzn.asia/d/am1lVUK&quot;&gt;参考文献[1]&lt;/a&gt;によると，切除平面法で一旦TSPをLPに緩和し，次に変数が整数条件を満たすように，有効な一次不等式を加えていくらしい．&lt;/p&gt;

&lt;p&gt;メタヒューリスティクスとしては，遺伝的アルゴリズムや量子アニーリングなどが使われているみたい．必要があれば，別途記事にするかもしれない．&lt;/p&gt;

&lt;h1 id=&quot;時間制約付き巡回セールスマン問題&quot;&gt;時間制約付き巡回セールスマン問題&lt;/h1&gt;

&lt;h2 id=&quot;定義-1&quot;&gt;定義&lt;/h2&gt;

&lt;p&gt;TSP-TWは，TSPの各ノードに到着時刻の制約を付けて拡張したものである．&lt;/p&gt;

&lt;h2 id=&quot;厳密解法-1&quot;&gt;厳密解法&lt;/h2&gt;

&lt;p&gt;線形な定式化は，私の調べたところ，&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S2212567115009260&quot;&gt;参考文献[3]&lt;/a&gt;しか見つからなかった．&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\begin{align}
\mathrm{Minimize:~} &amp; x_{n+1} \tag{4.1}\\
\mathrm{Subject~to:~} &amp; x_{i} \geq t_{0i}, &amp; i \in \{1, 2, \dots , n\} \tag{4.2} \\
&amp; x_{n+1} - x_{i} \geq t_{i0}, &amp; i \in \{1, 2, \dots , n\} \tag{4.3} \\
&amp; x_{i} \geq a_{i}, &amp; i \in \{1, 2, \dots , n\} \tag{4.4} \\
&amp; x_{i} \leq b_{i}, &amp; i \in \{1, 2, \dots , n\} \tag{4.5} \\
&amp; x_{i} - x_{j} \geq t_{ij} - My_{ij}, &amp; i,j \in \{1, 2, \dots , n\} \tag{4.6} \\
&amp; x_{j} - x_{i} \geq t_{ij} - M(1-y_{ij}), &amp; i,j \in \{1, 2, \dots , n\} \tag{4.7} \\
&amp; y_{ij} \in \{0, 1 \}, &amp; i,j \in \{1, 2, \dots , n\} \tag{4.8} \\

\end{align} %]]&gt;&lt;/script&gt;

&lt;p&gt;ここで，&lt;script type=&quot;math/tex&quot;&gt;i, j \in V&lt;/script&gt;はノードのインデックス，&lt;script type=&quot;math/tex&quot;&gt;n&lt;/script&gt;は始点と終点を除いたノード数，&lt;script type=&quot;math/tex&quot;&gt;t_{ij} \in \mathbb{R}&lt;/script&gt;はノード&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;-&lt;script type=&quot;math/tex&quot;&gt;j&lt;/script&gt;間の所与の移動時間，&lt;script type=&quot;math/tex&quot;&gt;a_{i} \in \mathbb{R}&lt;/script&gt;はノード&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;の所与の訪問可能開始時刻，&lt;script type=&quot;math/tex&quot;&gt;b_{i} \in \mathbb{R}&lt;/script&gt;はノード&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;の所与の訪問可能終了時刻，&lt;script type=&quot;math/tex&quot;&gt;M&lt;/script&gt;は十分大きな数であれば何でも良い．また，&lt;script type=&quot;math/tex&quot;&gt;x_{i} \in \mathbb{R}&lt;/script&gt;はノード&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;への到着時刻を表す変数，&lt;script type=&quot;math/tex&quot;&gt;y_{ij} \in \mathbb{R}&lt;/script&gt;はダミー変数であり，TSPではこれらを最適化する．&lt;/p&gt;

&lt;p&gt;式(3.1)-(3.6)との違いは，時間帯制約を表す式(4.4)および式(4.5)である．&lt;/p&gt;

&lt;h2 id=&quot;近似解法-1&quot;&gt;近似解法&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.semanticscholar.org/paper/A-Review-of-Traveling-Salesman-Problem-with-Time-Kona-Burde/008e3540e9a6c80f38794be3384b106ee8579194&quot;&gt;参考文献[4]&lt;/a&gt;によると，主に動的計画法（&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S0969601600000216&quot;&gt;参考文献[5]&lt;/a&gt;，&lt;a href=&quot;https://pubsonline.informs.org/doi/abs/10.1287/ijoc.1110.0456&quot;&gt;[8]&lt;/a&gt;，&lt;a href=&quot;https://www.semanticscholar.org/paper/A-Bi-directional-Resource-bounded-Dynamic-Approach-Li/8638fda3fefb9b2e103ad0b6d8acd1e4d14121bd&quot;&gt;[10]&lt;/a&gt;），Compressed annealing法（&lt;a href=&quot;https://pubsonline.informs.org/doi/abs/10.1287/ijoc.1050.0145?journalCode=ijoc&quot;&gt;参考文献[6]&lt;/a&gt;，&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S1568494613001658&quot;&gt;[9]&lt;/a&gt;），Ant colony法（&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S0895717707000507&quot;&gt;参考文献[7]&lt;/a&gt;，&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S1568494613001658&quot;&gt;[9]&lt;/a&gt;）などを使ったアプローチが提案されているようだ．&lt;/p&gt;

&lt;h1 id=&quot;感想&quot;&gt;感想&lt;/h1&gt;

&lt;p&gt;実用上，非常に面白い問題だが，意外と論文数は多くなかった&lt;sup id=&quot;fnref:search&quot;&gt;&lt;a href=&quot;#fn:search&quot; class=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;．&lt;/p&gt;

&lt;h1 id=&quot;参考文献&quot;&gt;参考文献&lt;/h1&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;http://amzn.asia/d/am1lVUK&quot;&gt;藤澤克樹，他，応用に役立つ50の最適化問題，2009&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://qiita.com/panchovie/items/6509fb54e3d53f4766aa&quot;&gt;Qiita，巡回セールスマン問題から始まる数理最適化&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S2212567115009260&quot;&gt;I. Kara and T. Derya, Formulations for minimizing tour duration fo the traveling salesman problem with time windows, Procedia Economics and Finance 26 (2015) 1026 -1034, 2015&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.semanticscholar.org/paper/A-Review-of-Traveling-Salesman-Problem-with-Time-Kona-Burde/008e3540e9a6c80f38794be3384b106ee8579194&quot;&gt;H. Kona, A review of traveling salesman problem with time window constraint, IJIRST Volume 2, Issue 01, 2015&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S0969601600000216&quot;&gt;K. Fagerholt and M. Christiansen, A traveling salesman problem with allocation, time window and precedence constraints-an application to ship scheduling, International Transactions in Operational Research, Vol 7, Issue 3, pp 231-244, 2000&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://pubsonline.informs.org/doi/abs/10.1287/ijoc.1050.0145?journalCode=ijoc&quot;&gt;J. W. Ohlmann and B. W. Thomas, Compressed-annealing heuristic for the traveling salesman problem with time windows, Informs Journal on Computing, vol 19, Issue 1, 2007&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S0895717707000507&quot;&gt;C.-B. Cheng and C.-P. Mao, A modified ant colony system for solving the travelling salesman problem with time windows, Mathematical and Computer Modeling, Vol 46, Issue 9-10, pp. 1225-1235, 2007&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://pubsonline.informs.org/doi/abs/10.1287/ijoc.1110.0456&quot;&gt;R. Baldacci, et al., New state-space relaxations for solving the traveling salesman problem with time windows, Informs Journal on Computing, Vol 24, Issue 3, 2011&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.sciencedirect.com/science/article/pii/S1568494613001658&quot;&gt;M. L.-Ibanez, et al., The travelling salesman problem with time windows: adapting algorithms from travel-time to makespan optimization, Applied Soft Computing, Vol 13, Issue 9, pp. 3806-3815, 2013&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.semanticscholar.org/paper/A-Bi-directional-Resource-bounded-Dynamic-Approach-Li/8638fda3fefb9b2e103ad0b6d8acd1e4d14121bd&quot;&gt;J.-Q. Li, A bi-directional resource-bounded dynamic programming approach for the traveling salesman problem with time windows, 2009&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:open&quot;&gt;
      &lt;p&gt;最初のノードと最後のノードが異なるパターンのTSPも研究されている． &lt;a href=&quot;#fnref:open&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:formulation&quot;&gt;
      &lt;p&gt;多分他にもある． &lt;a href=&quot;#fnref:formulation&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:revise&quot;&gt;
      &lt;p&gt;時間帯制約の除外に加え，&lt;script type=&quot;math/tex&quot;&gt;t_{i}&lt;/script&gt;を&lt;script type=&quot;math/tex&quot;&gt;x_{i}&lt;/script&gt;に変更したり，&lt;script type=&quot;math/tex&quot;&gt;x_{0}&lt;/script&gt;を式中から削除したり，（個人的な）わかりやすさのために一部修正した． &lt;a href=&quot;#fnref:revise&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:search&quot;&gt;
      &lt;p&gt;私の検索スキルが足りないだけかもしれないが． &lt;a href=&quot;#fnref:search&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 17 Sep 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/09/17/tsptw</link>
        <guid isPermaLink="true">http://localhost:4000/2018/09/17/tsptw</guid>
        
        
        <category>mathematics</category>
        
        <category>optimization</category>
        
        <category>paper</category>
        
      </item>
    
      <item>
        <title>Qiitaで情報発信していたら技術書デビューした</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://qiita.com/haltaro&quot;&gt;Qiita&lt;/a&gt;で公開していた&lt;a href=&quot;https://qiita.com/haltaro/items/d479538345357f08c595&quot;&gt;TCPの比較記事&lt;/a&gt;（本サイトの&lt;a href=&quot;https://haltaro.github.io/2018/07/13/tcp-ns3#undefined&quot;&gt;ns-3でTCPの輻輳制御を観察する&lt;/a&gt;）の結果を，&lt;a href=&quot;https://gihyo.jp/book/2018/978-4-7741-9941-2&quot;&gt;中嶋謙互，クラウドゲームをつくる技術―マルチプレイゲーム開発の新戦力，技術評論社&lt;/a&gt;に載せたいとオファーがあった．先日，ついに見本版が届いて，とても嬉しかったので経緯をメモしておく．&lt;/p&gt;

&lt;h1 id=&quot;背景&quot;&gt;背景&lt;/h1&gt;

&lt;p&gt;転職活動の一環として，&lt;a href=&quot;https://qiita.com/haltaro&quot;&gt;Qiitaアカウント&lt;/a&gt;を作成し，趣味でやっていたNetwork engineeringやMachine learningの結果を垂れ流していた．これだけのおかげとは言い切れない&lt;sup id=&quot;fnref:orei&quot;&gt;&lt;a href=&quot;#fn:orei&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;が，異業種・異職種への転職が無事成功した．&lt;/p&gt;

&lt;h1 id=&quot;経緯&quot;&gt;経緯&lt;/h1&gt;

&lt;p&gt;新しい仕事にも慣れ始めた2018年7月中旬，技術評論社の編集部の方からメールを頂いた．9月に出版予定の&lt;a href=&quot;https://gihyo.jp/book/2018/978-4-7741-9941-2&quot;&gt;中嶋謙互，クラウドゲームをつくる技術―マルチプレイゲーム開発の新戦力，技術評論社&lt;/a&gt;に，&lt;a href=&quot;https://qiita.com/haltaro/items/d479538345357f08c595&quot;&gt;Qiita，ns-3でTCPの輻輳制御を観察する&lt;/a&gt;の下図を掲載したいとのこと．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/comparing-tcp-algorithms.png&quot; alt=&quot;tcp&quot; /&gt;&lt;/p&gt;

&lt;p&gt;こんな機会はめったにないので，ぜひ載せてほしいと返事をした．掲載時のリンクを自由に指定できるようなので，どうせなら本サイトに誘導しようということで，&lt;a href=&quot;https://haltaro.github.io/2018/07/13/tcp-ns3#undefined&quot;&gt;ns-3でTCPの輻輳制御を観察する&lt;/a&gt;を作成した．また，本名が出るとかえって面倒なので，&lt;code class=&quot;highlighter-rouge&quot;&gt;haltaro&lt;/code&gt;のまま掲載して頂いた．&lt;/p&gt;

&lt;h1 id=&quot;見本版&quot;&gt;見本版&lt;/h1&gt;

&lt;p&gt;2018年9月13日，自宅に見本版が届いた．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-09-17-sample.jpg&quot; alt=&quot;sample&quot; /&gt;&lt;/p&gt;

&lt;p&gt;私のグラフは，図6.10として掲載されていた．見やすく整形されていて嬉しい&lt;sup id=&quot;fnref:png&quot;&gt;&lt;a href=&quot;#fn:png&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-09-17-figure.png&quot; alt=&quot;figure&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;感想&quot;&gt;感想&lt;/h1&gt;

&lt;p&gt;研究者として論文が公開されることはあっても，書籍として発行されたことは無かったので，新鮮で嬉しい経験だった．本書の中身自体は，別途記事にしたい．&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:orei&quot;&gt;
      &lt;p&gt;相談に乗ってくださった皆様，本当にありがとうございました． &lt;a href=&quot;#fnref:orei&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:png&quot;&gt;
      &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;.png&lt;/code&gt;形式で送ったので，かなり加工が面倒だったと思う． &lt;a href=&quot;#fnref:png&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 17 Sep 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/09/17/debut</link>
        <guid isPermaLink="true">http://localhost:4000/2018/09/17/debut</guid>
        
        
        <category>life</category>
        
      </item>
    
      <item>
        <title>DMM英会話受講メモ：2018年8月</title>
        <description>&lt;p&gt;&lt;a href=&quot;http://eikaiwa.dmm.com/&quot;&gt;DMM英会話&lt;/a&gt;の受講メモ．7回/31日なので，1/4以下．先月よりさらに頻度が下がったが，後半は本当に忙しかったのでしょうがない．&lt;/p&gt;

&lt;h1 id=&quot;20180802&quot;&gt;20180802&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/some-colleges-now-offer-scholarships-to-gamers/0JgKKI6vEei-yNNbrcDC_g&quot;&gt;Some Colleges Now Offer Scholarships to Gamers&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;slacker: a person who is lazy and has no desire to be successful&lt;/li&gt;
  &lt;li&gt;glued to (something): to focus on something and not pay attention to anything else&lt;/li&gt;
  &lt;li&gt;unwind: to relax&lt;/li&gt;
  &lt;li&gt;on board with: to agree with or support something&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180807&quot;&gt;20180807&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/the-most-and-least-educated-cities-in-the-us/PqKpiJDqEeiXbXfIMsHxTA&quot;&gt;The Most and Least Educated Cities in the US&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;diploma: 免状，卒業証書&lt;/li&gt;
  &lt;li&gt;最近バタバタしてなかなか授業を取れなかった．一週間以上空いてしまった．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180808&quot;&gt;20180808&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/homeless-find-employment-in-silicon-valley/G7VIDJVqEei2shdvfjyj6Q&quot;&gt;Homeless Find Employment in Silicon Valley&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;displacement: a situation when people are forced to leave their jobs&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180814&quot;&gt;20180814&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/print-yourself-a-house/vtv-IplcEei95iu2jRxArA&quot;&gt;Print Yourself a House&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;sewage: waste water from toilets and drains that is carried away by pipes&lt;/li&gt;
  &lt;li&gt;off the grid: not connected to public supplies of electricity, water, etc.&lt;/li&gt;
  &lt;li&gt;久しぶりの英語．思ったよりもまともに話せた気がする．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180815&quot;&gt;20180815&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/apples-stock-value-reaches-1-trillion-total/9yKMQpbwEeixf2saqcg-vQ&quot;&gt;Apple’s Stock Value Reaches $1 Trillion Total&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;skyrocket: to suddenly or quickly increase&lt;/li&gt;
  &lt;li&gt;fuel: to make something stronger&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180818&quot;&gt;20180818&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/google-celebrates-first-native-american-woman-engineer/HLepzJ5fEeircdPtlDMDzQ&quot;&gt;Google Celebrates First Native American Woman Engineer&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;久々のレッスン．先生がとても優しかった．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180823&quot;&gt;20180823&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/earthquake-safety-are-you-prepared/iB6LPqFPEei-GA_fQQLyFA&quot;&gt;Earthquake Safety: Are You Prepared?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;地震の準備についての記事．先生がとても親切だった．&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Fri, 31 Aug 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/08/31/dmm-english</link>
        <guid isPermaLink="true">http://localhost:4000/2018/08/31/dmm-english</guid>
        
        
        <category>english</category>
        
      </item>
    
      <item>
        <title>DMM英会話受講メモ：2018年7月</title>
        <description>&lt;p&gt;&lt;a href=&quot;http://eikaiwa.dmm.com/&quot;&gt;DMM英会話&lt;/a&gt;の受講メモ．9回/31日なので，1/3以下．もう少し頑張りたいところ．&lt;/p&gt;

&lt;h1 id=&quot;20180702&quot;&gt;20180702&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/first-ever-live-computer-human-debate-who-won/pQlh5HVWEeisU3utWASHDw&quot;&gt;First Ever Live Computer-Human Debate: Who Won?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;outsmart: to defeat someone by being more clever&lt;/li&gt;
  &lt;li&gt;persuasive: able to make people believe in what you say&lt;/li&gt;
  &lt;li&gt;ネット接続が不安定すぎて，全然会話が続かない．そろそろ本気でルーターの設定を見直すべき．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180705&quot;&gt;20180705&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;忙しかったので，10分だけフリートークしてもらった．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180707&quot;&gt;20180707&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/artificial-intelligence-used-to-track-worlds-wildlife/6JmNqnqpEeipU5OB2yBDmA&quot;&gt;Artificial Intelligence Used to Track World’s Wildlife&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;mate: to breed and produce young&lt;/li&gt;
  &lt;li&gt;breeding ground: a place where animals go to produce young&lt;/li&gt;
  &lt;li&gt;range: the area in which an animal lives, hunts, or travels&lt;/li&gt;
  &lt;li&gt;めちゃくちゃ優しい先生で，楽しかった．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180708&quot;&gt;20180708&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;接続が悪くて，10分くらいしか授業を受けられなかった．とりあえずフリートークしてもらった．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180713&quot;&gt;20180713&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/longest-lunar-eclipse-of-century-to-occur-in-july/cgirtn9fEeimg2ubzO6URA&quot;&gt;Longest Lunar Eclipse of Century to Occur in July&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;astronomical: relating to the sun, moon, and stars&lt;/li&gt;
  &lt;li&gt;reddish: 赤らんだ&lt;/li&gt;
  &lt;li&gt;glow: （赤い）光，輝き&lt;/li&gt;
  &lt;li&gt;PCを変えたら，問題なくスカイプできた．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180715&quot;&gt;20180715&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/how-to-make-money-playing-video-games/XS8xaHEkEei427cG-Yiqeg&quot;&gt;How to Make Money Playing Video Games&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;fanbase: the fans of a particular person, group, team, etc.&lt;/li&gt;
  &lt;li&gt;raw talent: natural ability&lt;/li&gt;
  &lt;li&gt;no-brainer: something that requires very little thought&lt;/li&gt;
  &lt;li&gt;distinction: a difference or contrast between two things&lt;/li&gt;
  &lt;li&gt;頭の回転が速い先生で，とても楽しかった．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180721&quot;&gt;20180721&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/scientists-find-possible-meteorite-pieces-in-ocean/O8xMVoRLEeiDMbNa2zYUwg&quot;&gt;Scientists Find Possible Meteorite Pieces in Ocean&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;meteorite：a piece of rock from space that has landed on earth&lt;/li&gt;
  &lt;li&gt;submarine：潜水艦&lt;/li&gt;
  &lt;li&gt;一週間ぶりの英会話．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180727&quot;&gt;20180727&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/scientists-say-early-risers-live-longer-but-why/k8pqoouXEeiDzf_NESPayw&quot;&gt;Scientists Say Early Risers Live Longer, but Why?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;lady’s fingers: オクラ&lt;/li&gt;
  &lt;li&gt;一週間ぶりの英会話（再び）．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;20180729&quot;&gt;20180729&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://app.eikaiwa.dmm.com/daily-news/article/us-man-wins-right-to-post-3-d-printed-gun-plans-online/7-L0NIwGEeiPPQ9dUUFRvg&quot;&gt;U.S. Man Wins Right to Post 3-D Printed Gun Plans Online&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;traficking: the buying and selling of illegal goods&lt;/li&gt;
  &lt;li&gt;なぜ日本で一般市民が銃を保有するのが違法なのか，という問いに，論理的に答えられなかった．日本語でも難しい．&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Wed, 08 Aug 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/08/08/dmm-english</link>
        <guid isPermaLink="true">http://localhost:4000/2018/08/08/dmm-english</guid>
        
        
        <category>english</category>
        
      </item>
    
      <item>
        <title>あまりに暑いのでProphetで140年分の気温を分析した</title>
        <description>&lt;p&gt;2018年7月22日，東京の最高気温は36.5度となり，今年最高を更新した．あまりに暑くてムシャクシャしたので，&lt;a href=&quot;http://www.data.jma.go.jp/gmd/risk/obsdl/index.php&quot;&gt;気象庁&lt;/a&gt;から約140年分（1872年1月1日-2018年7月21日）の東京の気温データを入手し，&lt;a href=&quot;https://facebook.github.io/prophet/&quot;&gt;Prophet&lt;/a&gt;で分析した．平均・最高・最低気温の全てに関して，1920年付近から上昇し続けており，そのトレンドを考慮してもなお，ここ数日は特に暑いことを確認できた．&lt;/p&gt;

&lt;p&gt;なお，分析に用いたNotebookは&lt;a href=&quot;https://github.com/haltaro/summer-prophet&quot;&gt;こちら&lt;/a&gt;．&lt;/p&gt;

&lt;h1 id=&quot;環境&quot;&gt;環境&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;macOS Sierra, 10.12.6&lt;/li&gt;
  &lt;li&gt;Python, 3.6.6&lt;/li&gt;
  &lt;li&gt;Prophet, 0.3&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;prophet&quot;&gt;Prophet&lt;/h1&gt;

&lt;h2 id=&quot;特徴&quot;&gt;特徴&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://facebook.github.io/prophet/&quot;&gt;Prophet&lt;/a&gt;とは，Facebookが開発したオープンソースの時系列解析ライブラリ．Prophetで想定するモデルを以下に示す：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;y(t) = g(t) + s(t) + h(t) + \epsilon(t)&lt;/script&gt;

&lt;p&gt;ここで，&lt;script type=&quot;math/tex&quot;&gt;y(t)&lt;/script&gt;は時点&lt;script type=&quot;math/tex&quot;&gt;t&lt;/script&gt;における予測値，&lt;script type=&quot;math/tex&quot;&gt;g(t)&lt;/script&gt;は時点&lt;script type=&quot;math/tex&quot;&gt;t&lt;/script&gt;におけるトレンド成分，&lt;script type=&quot;math/tex&quot;&gt;s(t)&lt;/script&gt;は時点&lt;script type=&quot;math/tex&quot;&gt;t&lt;/script&gt;における周期成分，&lt;script type=&quot;math/tex&quot;&gt;h(t)&lt;/script&gt;は時点&lt;script type=&quot;math/tex&quot;&gt;t&lt;/script&gt;における週末などのイレギュラーな成分，そして&lt;script type=&quot;math/tex&quot;&gt;\epsilon(t)&lt;/script&gt;は時点&lt;script type=&quot;math/tex&quot;&gt;t&lt;/script&gt;における誤差を表す．各成分のパラメータを&lt;a href=&quot;http://mc-stan.org/&quot;&gt;Stan&lt;/a&gt;で推定し，モデルを学習する．詳細なモデルは，原論文（&lt;a href=&quot;https://peerj.com/preprints/3190.pdf&quot;&gt;Sean J. Taylor and Benjamin Letham, Forecasting at Scale&lt;/a&gt;）を参照されたい．&lt;/p&gt;

&lt;p&gt;Prophetに関する日本語の記事としては，以下のようなものがある．とても参考になる．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://facebook.github.io/prophet/&quot;&gt;Prophet: forecasting at scale - Facebook&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.slideshare.net/hoxo_m/prophet-facebook-76285278&quot;&gt;Prophet入門【Python編】Facebookの時系列予測ツール - SlideShare&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://data.gunosy.io/entry/change-point-detection-prophet&quot;&gt;Facebookの予測ライブラリProphetを用いたトレンド抽出と変化点検知 - Gunosyデータ分析ブログ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Prophetの特徴は，時系列解析の前提知識がなくても，誰でも簡単に一定水準の分析をできること．&lt;/p&gt;

&lt;h2 id=&quot;インストール&quot;&gt;インストール&lt;/h2&gt;

&lt;p&gt;今回はPythonからProphetを使う．&lt;a href=&quot;https://pypi.org/project/pip/&quot;&gt;pip&lt;/a&gt;でインストールする場合は，&lt;code class=&quot;highlighter-rouge&quot;&gt;pip install fbprophet&lt;/code&gt;，&lt;a href=&quot;https://conda.readthedocs.io/en/latest/&quot;&gt;conda&lt;/a&gt;でインストールする場合は，&lt;code class=&quot;highlighter-rouge&quot;&gt;conda install -c conda-forge fbprophet&lt;/code&gt;．&lt;/p&gt;

&lt;h1 id=&quot;準備&quot;&gt;準備&lt;/h1&gt;

&lt;h2 id=&quot;データの入手&quot;&gt;データの入手&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.data.jma.go.jp/gmd/risk/obsdl/index.php#&quot;&gt;過去の気象データ・ダウンロード - 気象庁&lt;/a&gt;からcsvデータをダウンロードする．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;地点：東京&lt;/li&gt;
  &lt;li&gt;項目：
    &lt;ul&gt;
      &lt;li&gt;日別値&lt;/li&gt;
      &lt;li&gt;気温（平均気温，最高気温，最低気温）&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;期間：1872年1月1日 - 2018年7月21日（53528日）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;まず，以下の画面で都道府県および地区を選択する．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-area.png&quot; alt=&quot;area&quot; /&gt;&lt;/p&gt;

&lt;p&gt;次に，以下の画面で項目を選択する．降水量や湿度も興味深いが，一度にダウンロードできるデータ量に制限があるため，今回は気温（平均気温，最高気温，最低気温）のみを選択した．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-item.png&quot; alt=&quot;item&quot; /&gt;&lt;/p&gt;

&lt;p&gt;最後に，以下の画面で期間を選択する．1872年1月1日から指定可能だったので，選択する．一度にダウンロードできるデータ量に制限があるため，10年ごとに刻んでダウンロードする．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-period.png&quot; alt=&quot;period&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Downloadフォルダの&lt;code class=&quot;highlighter-rouge&quot;&gt;data.csv&lt;/code&gt;を年代ごとに改名し，&lt;code class=&quot;highlighter-rouge&quot;&gt;data/raw/&lt;/code&gt;以下に次のように保存する．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1870.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1880.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1890.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1900.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1910.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1920.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1930.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1940.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1950.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1960.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1970.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1980.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_1990.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_2000.csv&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;data_2010.csv&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;モジュールのインポート&quot;&gt;モジュールのインポート&lt;/h2&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/d5a8585a393c0c03a8958c5cb57e88e4.js&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;データの前処理&quot;&gt;データの前処理&lt;/h2&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/914eb08e9cfaa0ec4efeb6761329f292.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;以下で，詳細を補足する．&lt;/p&gt;

&lt;h3 id=&quot;codecsopen&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;codecs.open&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Shift-JIS&lt;/code&gt;で作成されているため，普通に&lt;code class=&quot;highlighter-rouge&quot;&gt;pandas.read_csv()&lt;/code&gt;でファイルを読み込めない．&lt;a href=&quot;https://qiita.com/niwaringo/items/d2a30e04e08da8eaa643&quot;&gt;pandasでread_csv時にUnicodeDecodeErrorが起きた時の対処 (pd.read_table()) - Qiita&lt;/a&gt;を参考に，&lt;code class=&quot;highlighter-rouge&quot;&gt;codecs.open()&lt;/code&gt;を利用する．&lt;/p&gt;

&lt;h3 id=&quot;不要な行列を除外&quot;&gt;不要な行・列を除外&lt;/h3&gt;

&lt;p&gt;元データをそのまま読み込むと，以下のように不要な行・列が含まれてしまう．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-data.png&quot; alt=&quot;data&quot; /&gt;&lt;/p&gt;

&lt;p&gt;そこで，&lt;a href=&quot;https://pandas.pydata.org/pandas-docs/version/0.23/generated/pandas.read_table.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pandas.read_table()&lt;/code&gt;&lt;/a&gt;のパラメータ&lt;code class=&quot;highlighter-rouge&quot;&gt;skiprows&lt;/code&gt;と&lt;code class=&quot;highlighter-rouge&quot;&gt;usecols&lt;/code&gt;を用いて，分析に必要な部分のみ抽出する．&lt;/p&gt;

&lt;h3 id=&quot;すべてnpnanの行は削除&quot;&gt;すべて&lt;code class=&quot;highlighter-rouge&quot;&gt;np.nan&lt;/code&gt;の行は削除&lt;/h3&gt;

&lt;p&gt;気象庁のサイト上では1872年1月1日から指定可能だったが，最初の数年分はデータが含まれていなかった．&lt;code class=&quot;highlighter-rouge&quot;&gt;pandas.DataFrame.dropna(how='all')&lt;/code&gt;で，すべての値が&lt;code class=&quot;highlighter-rouge&quot;&gt;np.nan&lt;/code&gt;の行を削除する．これにより全体の約2%にあたる1272日分のデータが除外された．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;地点：東京&lt;/li&gt;
  &lt;li&gt;項目：
    &lt;ul&gt;
      &lt;li&gt;日別値&lt;/li&gt;
      &lt;li&gt;気温（平均気温，最高気温，最低気温）&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;期間：1875年6月10日 - 2018年7月21日（52266日）&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;分析&quot;&gt;分析&lt;/h1&gt;

&lt;p&gt;平均気温，最高気温，および最低気温の分析を行う．&lt;/p&gt;

&lt;h2 id=&quot;平均気温&quot;&gt;平均気温&lt;/h2&gt;

&lt;p&gt;まず，すべての点を散布図でプロットしてみる．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/cac1b29446a8160a6defcf3be10c5edf.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-scatter_ave.png&quot; alt=&quot;scatter_ave&quot; /&gt;&lt;/p&gt;

&lt;p&gt;140年間で平均気温がじわじわ上がっていく様子がわかる．Prophetでより詳細に分析する．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/8db481c9a3d67d30a03c4d5291f49848.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;Prophetで時系列解析を行うためには，以下のカラムを持つ&lt;code class=&quot;highlighter-rouge&quot;&gt;pandas.DataFrame&lt;/code&gt;を生成する必要があるので注意．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ds&lt;/code&gt;：日付カラム．&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;y&lt;/code&gt;：予測対象カラム．&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;また，Prophetではデフォルトで&lt;code class=&quot;highlighter-rouge&quot;&gt;yearly_seasonality&lt;/code&gt;と&lt;code class=&quot;highlighter-rouge&quot;&gt;weekly_seasonality&lt;/code&gt;を考慮して学習する．気温が曜日に依存するとは考えづらいため，&lt;code class=&quot;highlighter-rouge&quot;&gt;weekly_seasonality&lt;/code&gt;を除外する．&lt;/p&gt;

&lt;p&gt;以上で学習したモデル&lt;code class=&quot;highlighter-rouge&quot;&gt;m&lt;/code&gt;を使い，将来30日間の平均気温を予測する．以下のように，&lt;code class=&quot;highlighter-rouge&quot;&gt;m.make_future_dataframe&lt;/code&gt;で&lt;code class=&quot;highlighter-rouge&quot;&gt;DataFrame&lt;/code&gt;を生成すると楽．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/efab9762d4911e1d6115e960cb1064f4.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;予測結果を&lt;code class=&quot;highlighter-rouge&quot;&gt;m.plot()&lt;/code&gt;でプロットする．約140年分プロットするとわけがわからないので，直近1年分のみを表示するようにする．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/f1f726cd4f0b2e0013e1cab948cd5029.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-forecast_ave.png&quot; alt=&quot;forecast_ave&quot; /&gt;&lt;/p&gt;

&lt;p&gt;黒点が実測値，青線の実線が予測値，そして薄い青の塗りつぶしが80%信頼区間&lt;sup id=&quot;fnref:interval&quot;&gt;&lt;a href=&quot;#fn:interval&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;を示す．ここ数日の平均気温は，信頼区間の上限ギリギリに張り付いていることが確認できる．例年から統計的に予測したとき，いかにここ数日の暑さが異常だったか，見て取れる&lt;sup id=&quot;fnref:outlier&quot;&gt;&lt;a href=&quot;#fn:outlier&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;．また，例年の傾向を考慮すると，気温のピークは8月初旬であるという絶望的な事実がわかる．&lt;/p&gt;

&lt;p&gt;次に，&lt;code class=&quot;highlighter-rouge&quot;&gt;m.plot_components(forecast)&lt;/code&gt;で周期性とトレンドを確認する．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/4a5a4cb1e3221fb83c658d78460eed42.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-components_ave.png&quot; alt=&quot;components_ave&quot; /&gt;&lt;/p&gt;

&lt;p&gt;上の図がトレンド，下の図が年内の周期性を表す．東京の平均気温は1920年あたりから上がり続けていることがわかる．また，年内で見ると，気温のピークは7月下旬から8月上旬にあることがわかる．&lt;/p&gt;

&lt;h2 id=&quot;最高気温&quot;&gt;最高気温&lt;/h2&gt;

&lt;p&gt;同様の分析を行う．詳細は割愛する．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-forecast_max.png&quot; alt=&quot;forecast_max&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-components_max.png&quot; alt=&quot;components_min&quot; /&gt;&lt;/p&gt;

&lt;p&gt;平均気温と同様の性質が見て取れる．&lt;/p&gt;

&lt;h2 id=&quot;最低気温&quot;&gt;最低気温&lt;/h2&gt;

&lt;p&gt;同様の分析を行う．詳細は割愛する．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-forecast_min.png&quot; alt=&quot;forecast_min&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-22-components_min.png&quot; alt=&quot;components_min&quot; /&gt;&lt;/p&gt;

&lt;p&gt;平均気温と同様の性質が見て取れる．&lt;/p&gt;

&lt;h1 id=&quot;感想&quot;&gt;感想&lt;/h1&gt;

&lt;p&gt;地学の知識が中学理科で止まっている私でも，比較的簡単に地球温暖化の様子を確認することができた&lt;sup id=&quot;fnref:donbiki&quot;&gt;&lt;a href=&quot;#fn:donbiki&quot; class=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;．Prophetすごい．&lt;/p&gt;

&lt;p&gt;あと，この記事を書き終わるころ，東洋経済さんの素晴らしい記事を見つけた（&lt;a href=&quot;https://toyokeizai.net/articles/-/229965&quot;&gt;東京の夏が｢昔より断然暑い｣決定的な裏づけ: 過去140年の最高気温をビジュアル化 - 東洋経済オンライン&lt;/a&gt;）&lt;sup id=&quot;fnref:trend&quot;&gt;&lt;a href=&quot;#fn:trend&quot; class=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;．こんなにわかりやすいヒートマップを初めて見た．いつかこんなビジュアライゼーションをしてみたい．&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:interval&quot;&gt;
      &lt;p&gt;デフォルト設定． &lt;a href=&quot;#fnref:interval&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:outlier&quot;&gt;
      &lt;p&gt;信頼区間を外れた異常値は他にも結構存在するが，連日，しかも同じ方向に外れることは珍しいように見える． &lt;a href=&quot;#fnref:outlier&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:donbiki&quot;&gt;
      &lt;p&gt;あまりに明確にトレンドが出過ぎてちょっと引いた． &lt;a href=&quot;#fnref:donbiki&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:trend&quot;&gt;
      &lt;p&gt;一応，1920年ごろから気温が上がり始めるという分析結果は，本記事と整合している．良かった． &lt;a href=&quot;#fnref:trend&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 22 Jul 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/07/22/summer-prophet</link>
        <guid isPermaLink="true">http://localhost:4000/2018/07/22/summer-prophet</guid>
        
        
        <category>statistics</category>
        
      </item>
    
      <item>
        <title>Trevor Hastie，統計的学習の基礎：2章，教師あり学習の基礎</title>
        <description>&lt;p&gt;夏休みの宿題として，&lt;a href=&quot;http://amzn.asia/ay0yxvo&quot;&gt;Trevor Hastie，統計的学習の基礎 ―データマイニング・推論・予測―&lt;/a&gt;を勉強している．以下は，&lt;strong&gt;第2章：教師あり学習の概要&lt;/strong&gt; のメモ．&lt;/p&gt;

&lt;h1 id=&quot;変数の種類と用語&quot;&gt;変数の種類と用語&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;順序付きカテゴリカル変数：値の順序のみに意味があり，計量としての意味がない変数．&lt;/li&gt;
  &lt;li&gt;記法：
    &lt;ul&gt;
      &lt;li&gt;&lt;script type=&quot;math/tex&quot;&gt;X&lt;/script&gt;：入力変数．&lt;/li&gt;
      &lt;li&gt;&lt;script type=&quot;math/tex&quot;&gt;Y&lt;/script&gt;：量的な出力．&lt;/li&gt;
      &lt;li&gt;&lt;script type=&quot;math/tex&quot;&gt;G&lt;/script&gt;：質的な出力．&lt;/li&gt;
      &lt;li&gt;変数そのものを指す場合は大文字（&lt;script type=&quot;math/tex&quot;&gt;X&lt;/script&gt;），観測値を指す場合は小文字（&lt;script type=&quot;math/tex&quot;&gt;x&lt;/script&gt;）．&lt;/li&gt;
      &lt;li&gt;行列を指す場合は太字の大文字（&lt;script type=&quot;math/tex&quot;&gt;\mathbf{X}&lt;/script&gt;），ベクトルを指す場合は，単なる大文字（&lt;script type=&quot;math/tex&quot;&gt;x&lt;/script&gt;）．&lt;/li&gt;
      &lt;li&gt;ベクトル&lt;script type=&quot;math/tex&quot;&gt;X&lt;/script&gt;の&lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;番目の要素の&lt;script type=&quot;math/tex&quot;&gt;n&lt;/script&gt;個の観測値をまとめてベクトルで表す場合は，太字で表す（&lt;script type=&quot;math/tex&quot;&gt;\mathbf{x}_i&lt;/script&gt;）．&lt;/li&gt;
      &lt;li&gt;予測値を指す場合は，ハットを用いる（&lt;script type=&quot;math/tex&quot;&gt;\hat{Y}&lt;/script&gt;）．&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;予測のための二つの簡単なアプローチ最近傍法&quot;&gt;予測のための二つの簡単なアプローチ：最近傍法&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;データ数が&lt;script type=&quot;math/tex&quot;&gt;N&lt;/script&gt;の&lt;script type=&quot;math/tex&quot;&gt;k&lt;/script&gt;最近傍法において，有効パラメータ数は&lt;script type=&quot;math/tex&quot;&gt;N/k&lt;/script&gt;．&lt;/li&gt;
  &lt;li&gt;最近傍法の拡張：
    &lt;ul&gt;
      &lt;li&gt;最近傍法では各点の重みを&lt;script type=&quot;math/tex&quot;&gt;\{0, 1\}&lt;/script&gt;で表すが，カーネル平滑化では滑らかな連続変数で表す．&lt;/li&gt;
      &lt;li&gt;高次元データの場合，距離尺度を特徴づけるカーネルに修正を加える．&lt;/li&gt;
      &lt;li&gt;最近傍法では近傍領域を定数モデルで表すが，局所重み付け最小二乗法を用いた局所線形モデルでは線形モデルで表す．&lt;/li&gt;
      &lt;li&gt;入力変数を基底展開して線形モデルを構築すると任意の複雑なモデルを構築できる．&lt;/li&gt;
      &lt;li&gt;射影追跡法やニューラルネットワークは，非線形変換と線形モデルを構築したもの．&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;統計的決定理論&quot;&gt;統計的決定理論&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;期待予測誤差（Expected Prediction Error）：&lt;script type=&quot;math/tex&quot;&gt;\mathrm{EPE}(f) = \int \left(y - f(x) \right)^2 \mathrm{Pr} (dx, dy)&lt;/script&gt;&lt;/li&gt;
  &lt;li&gt;EPEを最小化するのは，条件付き期待値：&lt;script type=&quot;math/tex&quot;&gt;\mathrm{E}(Y \mid X=x)&lt;/script&gt;&lt;/li&gt;
  &lt;li&gt;条件付け：同時分布を&lt;script type=&quot;math/tex&quot;&gt;\mathrm{Pr}(X, Y) = \mathrm{Pr}(Y \mid X)\mathrm{Pr}(X)&lt;/script&gt;のように分解すること．&lt;/li&gt;
  &lt;li&gt;十分な大きさの訓練データが得られれば，&lt;script type=&quot;math/tex&quot;&gt;\hat{f}(x) \rightarrow \mathrm{E}(Y \mid X=x)&lt;/script&gt;となり，万能な近似モデルとなる．&lt;/li&gt;
  &lt;li&gt;&lt;script type=&quot;math/tex&quot;&gt;\mathrm{card}(\mathcal{G})&lt;/script&gt;は，集合&lt;script type=&quot;math/tex&quot;&gt;\mathcal{G}&lt;/script&gt;の要素数を表す．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;高次元での局所的手法&quot;&gt;高次元での局所的手法&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;バイアス-分散分解．平均二乗誤差（MSE）を分解すると，次のようになる．&lt;script type=&quot;math/tex&quot;&gt;\mathrm{MSE}(x_0) = \mathrm{E}_{\tau}[f(x_0)-\hat{y}_0]^2 = \mathrm{Var}_{\tau}(\hat{y}_0) + \mathrm{Bias}^2(\hat{y}_0)&lt;/script&gt;．ここで，&lt;script type=&quot;math/tex&quot;&gt;\tau&lt;/script&gt;は訓練データ集合を表す．&lt;/li&gt;
  &lt;li&gt;制限の強い仮定に基づく線形モデルと，柔軟な最近傍法は両極端な性質を持つ．以降，これらの中間的な性質を持つ方法を学ぶ．&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;統計モデル教師あり学習関数近似&quot;&gt;統計モデル，教師あり学習，関数近似&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;線形基底展開：&lt;script type=&quot;math/tex&quot;&gt;f_{\theta}(x) = \sum_{k=1}^{K}h_k (x) \theta_k&lt;/script&gt;．
    &lt;ul&gt;
      &lt;li&gt;&lt;script type=&quot;math/tex&quot;&gt;h_k&lt;/script&gt;は入力ベクトル&lt;script type=&quot;math/tex&quot;&gt;x&lt;/script&gt;に関する関数や変換を表す．&lt;/li&gt;
      &lt;li&gt;ニューラルネットワークはこの一種であり，&lt;script type=&quot;math/tex&quot;&gt;h_k(x) = \frac{1}{1 + \mathrm{exp}(-x^{T}\beta_k)}&lt;/script&gt;．&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;残差二乗和（RSS; Sum of Squared Residuals）：&lt;script type=&quot;math/tex&quot;&gt;\mathrm{RSS}(\theta) = \sum_{i=1}^N (y_i - f_{\theta}(x_i))^2&lt;/script&gt;&lt;/li&gt;
  &lt;li&gt;最尤推定：対数尤度関数を最大化するパラメータ&lt;script type=&quot;math/tex&quot;&gt;\theta&lt;/script&gt;を採用する．
    &lt;ul&gt;
      &lt;li&gt;量的出力：&lt;script type=&quot;math/tex&quot;&gt;L(\theta) = \sum_{i=1}^N \mathrm{log} \mathrm{Pr}_{\theta} (y_i)&lt;/script&gt;を最小化する．ここで，&lt;script type=&quot;math/tex&quot;&gt;\mathrm{Pr}_{\theta}(y_i)&lt;/script&gt;は，パラメータ&lt;script type=&quot;math/tex&quot;&gt;\theta&lt;/script&gt;で特徴づけられた&lt;script type=&quot;math/tex&quot;&gt;Y&lt;/script&gt;の確率密度関数．加法的誤差モデル（&lt;script type=&quot;math/tex&quot;&gt;Y = f_{\theta} (X) + \epsilon&lt;/script&gt;）において，&lt;script type=&quot;math/tex&quot;&gt;\epsilon \sim \mathcal{N}(0, \sigma^2)&lt;/script&gt;ならば，最尤推定は最小二乗法と等価になる．&lt;/li&gt;
      &lt;li&gt;質的出力：&lt;script type=&quot;math/tex&quot;&gt;L(\theta) = \sum_{i=1}^N \mathrm{log} p_{g_i, \theta} (x_i)&lt;/script&gt;を最小化する．ここで，&lt;script type=&quot;math/tex&quot;&gt;p_{k, \theta} (x) = \mathrm{Pr}(G=\mathcal{G}_k \mid X=x)&lt;/script&gt;．交差エントロピーとも呼ぶ．&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;構造化回帰モデル&quot;&gt;構造化回帰モデル&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;残差二乗和&lt;script type=&quot;math/tex&quot;&gt;\mathrm{RSS}(f) = \sum_{i=1}^N (y_i - f(x_i))^2&lt;/script&gt;に基づいて関数&lt;script type=&quot;math/tex&quot;&gt;f&lt;/script&gt;を推定するとする．&lt;/li&gt;
  &lt;li&gt;データ数&lt;script type=&quot;math/tex&quot;&gt;N&lt;/script&gt;が有限の場合，関数&lt;script type=&quot;math/tex&quot;&gt;f&lt;/script&gt;を一意に求めるために，学習に対して制約を設ける．
    &lt;ul&gt;
      &lt;li&gt;制約の強さ：近傍領域の大きさ．&lt;/li&gt;
      &lt;li&gt;制約の複雑さ：近傍領域で想定する規則性．&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;等方性の小さい領域を近傍とする局所的な方法は，どのようなものであっても高次元データにうまく適用できない．&lt;/li&gt;
  &lt;li&gt;ノンパラメトリックな推定のためには，大きく分けて３つの方法がある．
    &lt;ul&gt;
      &lt;li&gt;粗度に対する罰則：残差二乗和にペナルティ項を追加する．&lt;script type=&quot;math/tex&quot;&gt;\mathrm{PRSS}(f; \lambda) = \mathrm{RSS}(f) + \lambda J(f)&lt;/script&gt;．射影追跡回帰や正則化など．ベイジアンの枠組みで理解することができる．&lt;/li&gt;
      &lt;li&gt;カーネル関数による局所関数近似：近傍領域をカーネル関数で表現し，明示的に回帰関数や条件付き期待値を推定する．&lt;/li&gt;
      &lt;li&gt;Dictionary method：基底関数を用いて関数を表現する．&lt;script type=&quot;math/tex&quot;&gt;f_{\theta}(x) = \sum_{m=1}^M \theta_m h_m (x)&lt;/script&gt;．&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;モデル選択とバイアスと分散のトレードオフ&quot;&gt;モデル選択と，バイアスと分散のトレードオフ&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;モデルの複雑度が増すと分散が増え，複雑度が減るとバイアスが増える．&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Fri, 20 Jul 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/07/20/esl-02</link>
        <guid isPermaLink="true">http://localhost:4000/2018/07/20/esl-02</guid>
        
        
        <category>machine learning</category>
        
        <category>statistics</category>
        
        <category>books</category>
        
      </item>
    
      <item>
        <title>7年もののMacBook ProがUbuntu 16.04に生まれ変わった</title>
        <description>&lt;p&gt;MacBook Pro（13-inch Early 2011）の動作が怪しくなってきた．かれこれ7年以上使っているので，そろそろ寿命なのかもしれない．&lt;a href=&quot;https://www.ubuntu.com/&quot;&gt;Ubuntu 16.04&lt;/a&gt;をインストールして，第二の人生を歩んでもらうことにした．&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.virment.com/making-installusb-ubuntu-mac/&quot;&gt;MacでubuntuのインストールUSBを作成する方法と手順 - virtualiment&lt;/a&gt;で作成したところ，おそらくフォーマッティングに問題があったため，私の環境ではUSBメモリでブートできなかった．結局，&lt;a href=&quot;https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-macos#0&quot;&gt;Ubuntu公式チュートリアル&lt;/a&gt;を参考に作業したらうまくいった．&lt;/p&gt;

&lt;h1 id=&quot;環境&quot;&gt;環境&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;MacBook Pro（13-inch Early 2011）
    &lt;ul&gt;
      &lt;li&gt;プロセッサ：2.7 GHz Intel Core i7&lt;/li&gt;
      &lt;li&gt;メモリ：8 GB 1333 MHz DDR3&lt;/li&gt;
      &lt;li&gt;グラフィックス：Intel HD Graphics 3000 512 MB&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;USBメモリ：2GB&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;手順&quot;&gt;手順&lt;/h1&gt;

&lt;h2 id=&quot;usbメモリの準備&quot;&gt;USBメモリの準備&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ディスクユーティリティ&lt;/code&gt;で，当該USBメモリを初期化する．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;フォーマット：MS-DOS (FAT)&lt;/li&gt;
  &lt;li&gt;方式：GUIDパーティションマップ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-15-disk-utility.png&quot; alt=&quot;disk-utility&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;isoファイルのダウンロード&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;iso&lt;/code&gt;ファイルのダウンロード&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.ubuntulinux.jp/News/ubuntu1604-ja-remix&quot;&gt;Ubuntu 16.04 LTS 日本語 Remix リリース - ubuntu japanese team&lt;/a&gt;&lt;sup id=&quot;fnref:lts&quot;&gt;&lt;a href=&quot;#fn:lts&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;より，&lt;code class=&quot;highlighter-rouge&quot;&gt;ubuntu-ja-16.04-desktop-amd64.iso&lt;/code&gt;をダウンロード．&lt;/p&gt;

&lt;h2 id=&quot;etcherによる書き込み&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Etcher&lt;/code&gt;による書き込み&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://etcher.io/&quot;&gt;Etcher&lt;/a&gt;をインストールして，起動する．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-15-etcher.png&quot; alt=&quot;etcher&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Select image&lt;/code&gt;で&lt;code class=&quot;highlighter-rouge&quot;&gt;ubuntu-ja-16.04-desktop-amd64.iso&lt;/code&gt;を，&lt;code class=&quot;highlighter-rouge&quot;&gt;Select drive&lt;/code&gt;で当該USBメモリを選択肢，&lt;code class=&quot;highlighter-rouge&quot;&gt;Flash!&lt;/code&gt;を押下．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/2018-07-15-etcher-config.png&quot; alt=&quot;etcher-config&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ブート&quot;&gt;ブート&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;option&lt;/code&gt;キーを押しながらMacを起動するが，なぜかUSBメモリが表示されなかった．&lt;a href=&quot;https://support.apple.com/ja-jp/ht202796&quot;&gt;別の起動ディスクを選択する方法 - Apple support&lt;/a&gt;を参考に，以下を実行すて再起動すると，無事表示された．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/3a9637266e9105c5302d88bd99a1e7c8.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;あとは，当該USBメモリを選択し，画面上の指示に従えばUbuntuのインストールが完了した．&lt;/p&gt;

&lt;h1 id=&quot;感想&quot;&gt;感想&lt;/h1&gt;

&lt;p&gt;なんだかんだで，&lt;a href=&quot;https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-macos#0&quot;&gt;公式チュートリアル&lt;/a&gt;を見るのが一番早かった．&lt;/p&gt;

&lt;p&gt;実は，無線LANに繋がらないという重大な問題が残っているが，これは以前投稿した&lt;a href=&quot;https://haltaro.github.io/2018/06/10/ucom-airmac&quot;&gt;UCOMとAirMacの問題&lt;/a&gt;と絡んでおり根が深い．解決したら改めて記事にする．&lt;/p&gt;

&lt;h1 id=&quot;参考&quot;&gt;参考&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.virment.com/making-installusb-ubuntu-mac/&quot;&gt;MacでubuntuのインストールUSBを作成する方法と手順 - virtualiment&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-macos#0&quot;&gt;Create a bootable USB stick on macOS - Ubuntu tutorials&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:lts&quot;&gt;
      &lt;p&gt;2018年7月15日時点で，&lt;a href=&quot;https://www.ubuntulinux.jp/News/ubuntu1804-ja-remix&quot;&gt;Ubuntu 18.04 LTS&lt;/a&gt;がリリースされているが，&lt;a href=&quot;https://linuxfan.info/ubuntu-18-04-issues&quot;&gt;まだ結構不具合がある&lt;/a&gt;みたいなので，使い慣れている16.04にした． &lt;a href=&quot;#fnref:lts&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Wed, 18 Jul 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/07/18/macos-to-ubuntu</link>
        <guid isPermaLink="true">http://localhost:4000/2018/07/18/macos-to-ubuntu</guid>
        
        
        <category>mac</category>
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>EC2にJupyter環境を構築する</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://aws.amazon.com/jp/&quot;&gt;AWS&lt;/a&gt;のEC2（Ubuntu 16.04 LTS）に，&lt;a href=&quot;http://jupyter.org/&quot;&gt;Jupyter notebook&lt;/a&gt;の環境を構築する手順をメモしておく．前提として，EC2インスタンスに対してSSH接続済みであり，Jupyterもインストール済みとする．EC2に限らず，リモートサーバ一般に共通する手順だと思う．&lt;/p&gt;

&lt;h1 id=&quot;リモート表示設定&quot;&gt;リモート表示設定&lt;/h1&gt;

&lt;p&gt;EC2上で立ち上げたJupyter notebookをブラウザ経由で使えるようにする．なお，以下の方法を使うと毎回パスワードの入力を求められるようになるので注意．&lt;/p&gt;

&lt;p&gt;まずは，&lt;code class=&quot;highlighter-rouge&quot;&gt;jupyter notebook --generate-config&lt;/code&gt;で設定ファイルを作成する．次に，&lt;code class=&quot;highlighter-rouge&quot;&gt;ipython&lt;/code&gt;を起動して，パスワードを設定する．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/f8096cc121c138e6596734221707ef81.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;~/.jupyter/jupyter_notebook_config.py&lt;/code&gt;を開いて，以下のように設定する．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/85d1e38eb1a24bb9bcae0b1d0cc3a2dd.js&quot;&gt;&lt;/script&gt;

&lt;h1 id=&quot;jupyter-notebook-extension&quot;&gt;Jupyter notebook extension&lt;/h1&gt;

&lt;p&gt;これはリモートサーバに限った作業ではないが，Jupyterの拡張機能をインストールする．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/f3e4403b4497a84819e84bed966caea4.js&quot;&gt;&lt;/script&gt;

&lt;h1 id=&quot;jupyter起動後によく使うスクリプト&quot;&gt;Jupyter起動後によく使うスクリプト&lt;/h1&gt;

&lt;p&gt;ついでに，Jupyter起動後によく使うスクリプトをメモしておく．&lt;/p&gt;

&lt;h2 id=&quot;notebookの初期設定&quot;&gt;Notebookの初期設定&lt;/h2&gt;

&lt;p&gt;グラフ表示および&lt;code class=&quot;highlighter-rouge&quot;&gt;warning&lt;/code&gt;表示について設定変更する．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/bd31358c4beef563d3fddbeba1d16085.js&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;よく使うモジュールのインポート&quot;&gt;よく使うモジュールのインポート&lt;/h2&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/72d7a2279f6e54a9bd007c86eef50829.js&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;フォントの設定&quot;&gt;フォントの設定&lt;/h2&gt;

&lt;p&gt;デフォルトのフォント設定だと，&lt;a href=&quot;https://matplotlib.org/&quot;&gt;matplotlib&lt;/a&gt;で日本語を表示できない．以下のようにフォント設定を変更する．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/6be570e6dee89957a8ffdf149f782048.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;なお，上記はUbuntu用の設定である．他のOSについては，別途対応されたい．&lt;/p&gt;

&lt;h2 id=&quot;bokehの設定&quot;&gt;Bokehの設定&lt;/h2&gt;

&lt;p&gt;デフォルト設定で日本語を表示できるし，ホバー表示がイイ感なので，最近は&lt;a href=&quot;https://bokeh.pydata.org/en/latest/&quot;&gt;Bokeh&lt;/a&gt;を使うことも多い．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/13a47550e6370419dac842206c2cd769.js&quot;&gt;&lt;/script&gt;

&lt;h1 id=&quot;参考&quot;&gt;参考&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://qiita.com/syo_cream/items/05553b41277523a131fd&quot;&gt;リモートサーバでjupyter notebookを起動させローカル環境で使う - Qiita&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://qiita.com/sasaki77/items/30a19d2be7d94116b237&quot;&gt;extensionを追加してもっと快適なJupyter環境を構築する - Qiita&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/ipython-contrib/jupyter_contrib_nbextensions&quot;&gt;Jupyter notebook extensions - GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Sun, 15 Jul 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/07/15/jupyter-ec2</link>
        <guid isPermaLink="true">http://localhost:4000/2018/07/15/jupyter-ec2</guid>
        
        
        <category>aws</category>
        
        <category>python</category>
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>EC2にS3をマウントする</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://aws.amazon.com/jp/&quot;&gt;AWS&lt;/a&gt;のEC2（Ubuntu 16.04 LTS）に，S3をマウントする手順をメモしておく．前提として，EC2インスタンスに対して，SSH接続済みとする．&lt;/p&gt;

&lt;h1 id=&quot;環境&quot;&gt;環境&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;Ubuntu Server 16.04 LTS (HVM), SSD Volume Type&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;手順&quot;&gt;手順&lt;/h1&gt;

&lt;h2 id=&quot;s3-bucketを準備する&quot;&gt;S3 bucketを準備する&lt;/h2&gt;

&lt;p&gt;マウントしたいEC2インスタンスと同じリージョンを選択すること．&lt;/p&gt;

&lt;h2 id=&quot;iamロールの準備&quot;&gt;IAMロールの準備&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;信頼関係：
    &lt;ul&gt;
      &lt;li&gt;ロールを利用するサービス：EC2&lt;/li&gt;
      &lt;li&gt;ユースケースの選択：EC2&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;アクセス権限
    &lt;ul&gt;
      &lt;li&gt;ポリシー名：AmazonS3FullAccess&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;作成したロールをEC2インスタンスに割り当てる．&lt;/p&gt;

&lt;h2 id=&quot;s3fs-fuseのインストール&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;s3fs-fuse&lt;/code&gt;のインストール&lt;/h2&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/041eeaab46a6ed5d111ba8b4da742759.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;以下のコマンドでS3をマウントできる．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/fb68727dfc45c7a9ca45cc2373e180b5.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;なお，&lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt;と&lt;code class=&quot;highlighter-rouge&quot;&gt;gid&lt;/code&gt;は&lt;code class=&quot;highlighter-rouge&quot;&gt;id ubuntu&lt;/code&gt;で確認した値を設定すること．&lt;/p&gt;

&lt;h2 id=&quot;マウントの自動化&quot;&gt;マウントの自動化&lt;/h2&gt;

&lt;p&gt;ここで結構ハマった．&lt;code class=&quot;highlighter-rouge&quot;&gt;rc.local&lt;/code&gt;で設定する方法で実現したかったが，どうしてもうまくいかなかったので，&lt;code class=&quot;highlighter-rouge&quot;&gt;.bashrc&lt;/code&gt;で設定した．参考のため，以下に試行錯誤の記録を残す．&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://qiita.com/shicky1121/items/e19b50308c79e5a6081e&quot;&gt;EC2インスタンスにS3をマウントする - Qiita&lt;/a&gt;を参考に，&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/rc.local&lt;/code&gt;に以下を追記した．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/d0d44e135b154d3a33ff0369d9d20deb.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;Ubuntu 16.04だと，上記の方法では起動時に実行されないようだ．&lt;a href=&quot;https://qiita.com/msrks/items/5201ae15d0e1f8de5946&quot;&gt;Ubuntu16.04でスクリプトを起動時に自動実行する - Qiita&lt;/a&gt;を参考にサービスファイルを作成したが，何故かうまく動作しなかった．&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://askubuntu.com/questions/765120/after-upgrade-to-16-04-lts-rc-local-is-not-executing-a-command&quot;&gt;After upgrade to 16.04 LTS rc.local is not executing a command - StackExchange&lt;/a&gt;を参考に，以下のように変更してみた．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/47b8ef513273903bddd0e4f4a378eac2.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;そして，&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/rc.local&lt;/code&gt;の一行目を&lt;code class=&quot;highlighter-rouge&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh -e&lt;/span&gt;&lt;/code&gt;から&lt;code class=&quot;highlighter-rouge&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/code&gt;に変更する．上記でもうまくいかないので，&lt;code class=&quot;highlighter-rouge&quot;&gt;~/.bashrc&lt;/code&gt;に以下を追記した．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/339ab269a4d200247137a6635e0f26c2.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;うまくいった．bashを起動するたびにマウントされちゃうので，あまり良くない気がする．&lt;/p&gt;

&lt;h1 id=&quot;参考&quot;&gt;参考&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://qiita.com/shicky1121/items/e19b50308c79e5a6081e&quot;&gt;EC2インスタンスにS3をマウントする - Qiita&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://qiita.com/msrks/items/5201ae15d0e1f8de5946&quot;&gt;Ubuntu16.04でスクリプトを起動時に自動実行する - Qiita&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://askubuntu.com/questions/765120/after-upgrade-to-16-04-lts-rc-local-is-not-executing-a-command&quot;&gt;After upgrade to 16.04 LTS rc.local is not executing a command - StackExchange&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Sun, 15 Jul 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/07/15/ec2-s3</link>
        <guid isPermaLink="true">http://localhost:4000/2018/07/15/ec2-s3</guid>
        
        
        <category>aws</category>
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>ns-3でTCPの輻輳制御を観察する</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://www.nsnam.org/&quot;&gt;ns-3&lt;/a&gt;でTCPの輻輳制御アルゴリズムをシミュレートし，その動作をmatplotlibで可視化した．本記事は，&lt;a href=&quot;https://qiita.com/haltaro/items/d479538345357f08c595&quot;&gt;2017年2月20日にQiitaに投稿した記事&lt;/a&gt;を，本サイト向けに再構成したもの．&lt;/p&gt;

&lt;h1 id=&quot;はじめに&quot;&gt;はじめに&lt;/h1&gt;

&lt;p&gt;インターネット上のほとんどのトラフィックは，&lt;strong&gt;TCP（Transmission Control Protocol）&lt;/strong&gt;によって制御されていると言われています．TCPの特徴の一つとして，送信ノードが各々&lt;strong&gt;輻輳&lt;sup id=&quot;fnref:congestion&quot;&gt;&lt;a href=&quot;#fn:congestion&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;制御アルゴリズム（Congestion control algorithm）&lt;/strong&gt;に基づき，一度に送信するデータ量を調整する，という点があります．本記事では，&lt;a href=&quot;https://www.nsnam.org/&quot;&gt;ns-3&lt;/a&gt;で各アルゴリズムの動作をシミュレートし，&lt;a href=&quot;http://www.numpy.org/&quot;&gt;NumPy&lt;/a&gt; + &lt;a href=&quot;http://matplotlib.org/&quot;&gt;matplotlib&lt;/a&gt;で視覚化します．&lt;/p&gt;

&lt;p&gt;TCPの輻輳制御アルゴリズムを比較するために，ns-3には&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-variants-comparison_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-variants-comparison.cc&lt;/code&gt;&lt;/a&gt;というサンプルシナリオが用意されています．しかし，このシナリオスクリプトをそのまま使うと，本記事で注目するいくつかの変数をモニタ（ns-3では，&lt;strong&gt;トレース&lt;/strong&gt;と呼びます）できない，という課題がありました．そこで，本記事では，シナリオスクリプトに任意のトレース情報を追加する方法を紹介します．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/c67dba4f-93ce-0618-c980-22c888d3afc7.png&quot; alt=&quot;TcpAll20.0-cwnd.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;なお，本記事のソースコードは，全て&lt;a href=&quot;https://github.com/haltaro/comparing-tcp-algorithms&quot;&gt;Github&lt;/a&gt;に置いてあります．&lt;/p&gt;

&lt;h1 id=&quot;環境構築&quot;&gt;環境構築&lt;/h1&gt;

&lt;h2 id=&quot;ns-3-network-simulator-3&quot;&gt;ns-3 (Network Simulator 3)&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.nsnam.org/&quot;&gt;ns-3&lt;/a&gt;は，オープンソースの離散事象ネットワークシミュレータです．研究や教育用途での使用を目的に開発されています．本記事では，下記の記事で構築した環境及びディレクトリ構成を前提とします．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://qiita.com/haltaro/items/b474d924f63692c155c8&quot;&gt;ns-3.26で始めるネットワークシミュレーション&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;python&quot;&gt;python&lt;/h2&gt;

&lt;p&gt;本記事では，データ処理に&lt;a href=&quot;http://www.numpy.org/&quot;&gt;NumPy&lt;/a&gt;，グラフ描画に&lt;a href=&quot;http://matplotlib.org/&quot;&gt;matplotlib&lt;/a&gt;を利用します．下記の環境で動作を確認しました．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Python 2.7.11&lt;/li&gt;
  &lt;li&gt;NumPy 1.10.4&lt;/li&gt;
  &lt;li&gt;matplotlib 1.5.1&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;tcpにおける輻輳制御&quot;&gt;TCPにおける輻輳制御&lt;/h1&gt;

&lt;h2 id=&quot;概要&quot;&gt;概要&lt;/h2&gt;

&lt;p&gt;下図は，本記事で想定するTCP輻輳制御のイメージです．TCPの送信ノード（TCP Sender）は，受信ノード（TCP Receiver）からの確認応答（Acknowledgement，ACK）&lt;sup id=&quot;fnref:delayedACK&quot;&gt;&lt;a href=&quot;#fn:delayedACK&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&quot;fnref:ACKnumber&quot;&gt;&lt;a href=&quot;#fn:ACKnumber&quot; class=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;や信号往復時間（Round Trip Time，RTT）に応じて，データ量（DATA）を調整します．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/ea523d49-c229-2d46-a3c5-7290b3f82dff.png&quot; alt=&quot;model.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;厳密には，データ量の調整は，&lt;script type=&quot;math/tex&quot;&gt;swnd=min(awnd, cwnd)&lt;/script&gt;という式で表現できます．ここで，&lt;script type=&quot;math/tex&quot;&gt;swnd&lt;/script&gt;はTCP SenderがACK無しに送信可能なDATA数の上限値であり，&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;はTCP Senderが自律的に調整するウインドウサイズ（Congestion window）であり，&lt;script type=&quot;math/tex&quot;&gt;awnd&lt;/script&gt;はTCP Receiverから告知されるウインドウサイズ（Advertised window）です．上式の単位はセグメントと呼ばれ，1セグメントの大きさはTCP SenderとReceiverのネゴシエーションで決まります．&lt;script type=&quot;math/tex&quot;&gt;awnd&lt;/script&gt;は非常に大きい値に設定されることが多いため，簡単のため，本記事では&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;のみに注目します．&lt;/p&gt;

&lt;p&gt;&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;が大きいほど，たくさんのデータを一度に送ることができます．TCP Senderは，ACKやRTTから，Receiverとの間のネットワークの混み具合を予測して，自律的に&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;の大きさを調整します．&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;の調整戦略を，本記事では&lt;strong&gt;輻輳制御&lt;/strong&gt;と呼びます．&lt;/p&gt;

&lt;p&gt;輻輳制御は，&lt;strong&gt;輻輳状態&lt;sup id=&quot;fnref:state&quot;&gt;&lt;a href=&quot;#fn:state&quot; class=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/strong&gt;（Congestion state）と，&lt;strong&gt;アルゴリズム&lt;/strong&gt;（Congestion control algorithm）という２つの要素によって決まります．輻輳状態は，&lt;em&gt;OPEN&lt;/em&gt;，&lt;em&gt;DISORDER&lt;/em&gt;，&lt;em&gt;RECOVER&lt;/em&gt;，&lt;em&gt;LOSS&lt;/em&gt;等，ネットワークの混雑状態を表します．アルゴリズムは，各輻輳状態における&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;の更新方法を表します．&lt;/p&gt;

&lt;h2 id=&quot;輻輳状態congestion-state&quot;&gt;輻輳状態（Congestion state）&lt;/h2&gt;
&lt;p&gt;　本記事では，ns-3の実装（&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-socket-base_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;~/ns-3.26/source/ns-3.26/src/internet/model/tcp-socket-base.cc&lt;/code&gt;&lt;/a&gt;）に基づき，以下の4種類の輻輳状態を想定します．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/29f58349-b23e-636f-64f9-2798a899eb34.png&quot; alt=&quot;state.png&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;OPEN&lt;/em&gt;：いわゆる正常な状態です．アルゴリズムによっては，Slow start（SS）とCongestion avoidance（CA）という二種類のフェーズを持ちます．&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;が閾値（Slow start threshold, &lt;script type=&quot;math/tex&quot;&gt;ssth&lt;/script&gt;）より小さいときはSlow startフェーズに，大きいときはCongestion avoidanceフェーズに該当します．&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;DISORDER&lt;/em&gt;：重複ACK（Duplicate ACK）を受信した状態です．パケットロスや受信順序の乱れ等の可能性があります．&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;RECOVERY&lt;/em&gt;：3度重複ACK（Triple duplicate ACK）を受信した状態です．パケットロスを確信し，再送を開始します．&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;LOSS&lt;/em&gt;：RTTが再送タイムアウト時間（Retransmission Time Out, RTO）より大きくなる，つまりACKのタイムアウトを検知した状態です．深刻な輻輳が生じている可能性があります．&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;輻輳制御アルゴリズムcongestion-control-algorithm&quot;&gt;輻輳制御アルゴリズム（Congestion control algorithm）&lt;/h2&gt;

&lt;p&gt;本記事では，ns-3の&lt;a href=&quot;https://www.nsnam.org/docs/models/html/tcp.html&quot;&gt;実装&lt;/a&gt;に基づき，以下の輻輳制御アルゴリズムを想定します．&lt;code class=&quot;highlighter-rouge&quot;&gt;TypeId&lt;/code&gt;とは，ns-3におけるアルゴリズムの呼び名のようなものです．ソースコードは，それぞれ&lt;code class=&quot;highlighter-rouge&quot;&gt;~/ns-3.26/source/ns-3.26/src/internet/model&lt;/code&gt;に格納されています．&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;アルゴリズム&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TypeId&lt;/code&gt;&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ソースコード&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc6582&quot;&gt;NewReno&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpNewReno&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-congestion-ops_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-congestion-ops.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc3649&quot;&gt;HighSpeed&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpHighSpeed&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-highspeed_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-highspeed.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;http://www.mathcs.emory.edu/~cheung/Courses/558/Syllabus/Papers/TCP-Hybla.pdf&quot;&gt;Hybla&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpHybla&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-hybla_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-hybla.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://pdfs.semanticscholar.org/d3f0/a499906d7821cf204d9ca26900c11179777e.pdf&quot;&gt;Westwood&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpWestwood&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-westwood_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-westwood.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Westwood+&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpWestwoodPlus&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-westwood_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-westwood.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;http://cseweb.ucsd.edu/~rbraud/jsac.pdf&quot;&gt;Vegas&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpVegas&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-vegas_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-vegas.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.107.5330&amp;amp;rep=rep1&amp;amp;type=pdf&quot;&gt;Scalable&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpScalable&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-scalable_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-scalable.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;http://ieeexplore.ieee.org/document/1177186/&quot;&gt;Veno&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpVeno&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-veno_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-veno.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;http://infocom2004.ieee-infocom.org/Papers/52_4.PDF&quot;&gt;Bic&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpBic&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-bic_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-bic.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;http://infocom.uniroma1.it/~vacirca/yeah/yeah.pdf&quot;&gt;YeAH&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpYeah&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-yeah_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-yeah.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;http://dl.acm.org/citation.cfm?id=1190166&quot;&gt;Illinois&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpIllinois&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-illinois_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-illinois.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.3.7816&amp;amp;rep=rep1&amp;amp;type=pdf&quot;&gt;H-TCP&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpHtcp&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-htcp_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-htcp.cc&lt;/code&gt;&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;例えば，最もメジャーな輻輳制御アルゴリズムの１つである&lt;a href=&quot;https://tools.ietf.org/html/rfc6582&quot;&gt;NewReno&lt;/a&gt;（Reno）は，各輻輳状態において次のように&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;を更新します．&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;更新契機&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;更新式&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;em&gt;OPEN&lt;/em&gt;（SS）状態で，ACKを受信したとき&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;script type=&quot;math/tex&quot;&gt;cwnd \gets cwnd + 1&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;em&gt;OPEN&lt;/em&gt;（CA）状態で，ACKを受信したとき&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;script type=&quot;math/tex&quot;&gt;\displaystyle cwnd \gets cwnd + \frac{1}{cwnd}&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;em&gt;RECOVERY&lt;/em&gt;状態に遷移したとき&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;script type=&quot;math/tex&quot;&gt;ssth \gets max(\mathit{inflight} /2, 2 \cdot smss)&lt;/script&gt;, &lt;bf&gt; $$cwnd \gets ssth +3$$&lt;/bf&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;em&gt;RECOVERY&lt;/em&gt;状態で，重複ACKを受信したとき&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;script type=&quot;math/tex&quot;&gt;\displaystyle cwnd \gets cwnd + 1&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;em&gt;RECOVERY&lt;/em&gt;状態で，新規ACKを受信し，&lt;em&gt;OPEN&lt;/em&gt;状態に遷移したとき&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;script type=&quot;math/tex&quot;&gt;cwnd \gets ssth&lt;/script&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;em&gt;LOSS&lt;/em&gt;状態に遷移したとき&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;script type=&quot;math/tex&quot;&gt;cwnd \gets smss&lt;/script&gt;，&lt;bf&gt; $$ssth \gets max(\mathit{inflight} /2, 2 \cdot smss)$$&lt;/bf&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ここで，&lt;script type=&quot;math/tex&quot;&gt;\mathit{inflight}&lt;/script&gt;は，ACKが返っていないDATAの総量を表し，&lt;script type=&quot;math/tex&quot;&gt;smss&lt;/script&gt;は最小セグメントサイズを表します．また，簡単のためPartial ACKやFull ACK等は考慮していません．NewRenoの動作の詳細は，&lt;a href=&quot;https://tools.ietf.org/html/rfc6582&quot;&gt;RFC6582&lt;/a&gt;等をご参照ください．&lt;/p&gt;

&lt;p&gt;NewRenoは，輻輳の可能性が低いと思われるSlow startフェーズにおいては，&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;を高速に増加させることでDATAを効率的に送信し，一方で輻輳の可能性が高いと思われるCongestion avoidanceフェーズにおいては，徐々に&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;を上げることで急激な輻輳を回避する，という戦略を採用しています．&lt;/p&gt;

&lt;p&gt;ACK受信を契機とする更新式は，&lt;strong&gt;1セグメント分のACKに対する更新式&lt;/strong&gt;という点にご注意ください（私はここでハマりました）．例えば，&lt;script type=&quot;math/tex&quot;&gt;cwnd=4&lt;/script&gt;のとき，TCP Senderは4セグメント分のDATAに対するACKを受信するため，上記の更新を&lt;strong&gt;4回&lt;/strong&gt;行います．&lt;/p&gt;

&lt;p&gt;なお，&lt;a href=&quot;https://www.nsnam.org/docs/models/html/tcp.html&quot;&gt;ns-3におけるTCPの実装&lt;/a&gt;は以下の3種類がありますが，本記事ではns-3ネイティブ（&lt;code class=&quot;highlighter-rouge&quot;&gt;src/internet/model&lt;/code&gt;）で実装されているアルゴリズムのみを対象とします．つまり，Linuxでメジャーな&lt;a href=&quot;http://dl.acm.org/citation.cfm?id=1400105&quot;&gt;CUBIC&lt;/a&gt;や，Windowsでメジャーな&lt;a href=&quot;http://www.dcs.gla.ac.uk/~lewis/CTCP.pdf&quot;&gt;CTCP&lt;/a&gt;は対象外です．これらについては，別途ご紹介できればと思っています．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ns-3ネイティブ（&lt;code class=&quot;highlighter-rouge&quot;&gt;src/internet/&lt;/code&gt;）&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.wand.net.nz/~stj2/nsc/&quot;&gt;NSC（Network Simulation Cradle）&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.nsnam.org/overview/projects/direct-code-execution/&quot;&gt;DCE（Direct Code Execution）&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;シナリオスクリプトの作成&quot;&gt;シナリオスクリプトの作成&lt;/h1&gt;

&lt;p&gt;本章では，もとにするサンプルシナリオ&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-variants-comparison.cc&lt;/code&gt;の解説と，その課題，そして修正版の&lt;code class=&quot;highlighter-rouge&quot;&gt;my-tcp-variants-comparison.cc&lt;/code&gt;をご紹介します．&lt;/p&gt;

&lt;h2 id=&quot;もとにするサンプルシナリオ&quot;&gt;もとにするサンプルシナリオ&lt;/h2&gt;

&lt;p&gt;ns-3は，TCPの輻輳制御アルゴリズムの比較用に，&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-variants-comparison_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-variants-comparison.cc&lt;/code&gt;&lt;/a&gt;
というサンプルシナリオを用意しています（&lt;code class=&quot;highlighter-rouge&quot;&gt;~/ns-3.26/source/ns-3.26/examples/tcp/&lt;/code&gt;にあります）．本シナリオスクリプトは，以下の変数の時変化をトレースし，ファイルに出力することが可能です．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cwnd：前記&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;．ただし単位はバイトです．&lt;/li&gt;
  &lt;li&gt;SsThresh：前記&lt;script type=&quot;math/tex&quot;&gt;ssth&lt;/script&gt;．ただし単位はバイトです．&lt;/li&gt;
  &lt;li&gt;Rtt：前記RTT．単位は[s]です．&lt;/li&gt;
  &lt;li&gt;Rto：前記RTO．単位は[s]です．&lt;/li&gt;
  &lt;li&gt;NextTx：TCP Senderが次に送信する予定のSequence numberです．&lt;/li&gt;
  &lt;li&gt;NextRx：TCP Receiverが次に受信する予定のSequence numberです．&lt;/li&gt;
  &lt;li&gt;InFlight：前記&lt;script type=&quot;math/tex&quot;&gt;\mathit{inflight}&lt;/script&gt;．ただし，単位はバイトです．TCPの原理上，必ず&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;以下になります．&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;以下では，本記事のテーマである&lt;strong&gt;トレース&lt;/strong&gt;に特にスポットを当て，ソースコードを解説します．&lt;/p&gt;

&lt;h3 id=&quot;トレース用変数&quot;&gt;トレース用変数&lt;/h3&gt;

&lt;p&gt;58行目から70行目で，トレースに用いる変数の定義を行います．&lt;code class=&quot;highlighter-rouge&quot;&gt;bool first*&lt;/code&gt;は，それぞれトレース対象の初期値を出力するか否かを表し，&lt;code class=&quot;highlighter-rouge&quot;&gt;Ptr&amp;lt;OutputStreamWrapper&amp;gt; *Stream&lt;/code&gt;は，それぞれトレース対象をファイル出力するためのストリームを表し，&lt;code class=&quot;highlighter-rouge&quot;&gt;uint32_t *Value&lt;/code&gt;は，それぞれトレース対象の初期値を取り扱う際に一時的に使用される変数を表します．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/37d8d7e137ce2490b0269658f357dd54.js&quot;&gt;&lt;/script&gt;

&lt;h3 id=&quot;トレース用コールバック関数の設定&quot;&gt;トレース用コールバック関数の設定&lt;/h3&gt;

&lt;p&gt;73行目から145行目ではトレース用コールバック関数&lt;code class=&quot;highlighter-rouge&quot;&gt;*Tracer()&lt;/code&gt;の定義を，147行目から202行目ではコールバック関数をトレース対象と紐付ける関数&lt;code class=&quot;highlighter-rouge&quot;&gt;Trace*()&lt;/code&gt;の定義を行います．ここでは，トレース対象の１つである&lt;code class=&quot;highlighter-rouge&quot;&gt;BytesInFlight&lt;/code&gt;を例に解説します．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/44d3d4dd1e11c0f580958b7ed550303a.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;ns-3においては，ソースファイル（&lt;code class=&quot;highlighter-rouge&quot;&gt;ns-3.26/source/ns-3.26/src/*/model/&lt;/code&gt;）中で&lt;code class=&quot;highlighter-rouge&quot;&gt;AddTraceSource()&lt;/code&gt;された全ての変数を，シナリオスクリプト中でトレース対象として設定することができます．例えば，上記の&lt;code class=&quot;highlighter-rouge&quot;&gt;BytesInFlight&lt;/code&gt;は，&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-socket-base_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;~/ns-3.26/source/ns-3.26/src/internet/model/tcp-socket-base.cc&lt;/code&gt;&lt;/a&gt;において&lt;code class=&quot;highlighter-rouge&quot;&gt;AddTraceSource()&lt;/code&gt;されています．ns-3は，トレース対象となった変数が更新される度に，その変数に紐付けられたコールバック関数を呼び出します．よって，トレース対象の設定には，&lt;strong&gt;コールバック関数の定義&lt;/strong&gt;と，&lt;strong&gt;トレース対象とコールバック関数の紐付け&lt;/strong&gt;が必要です．&lt;/p&gt;

&lt;p&gt;コールバック関数として，上記&lt;code class=&quot;highlighter-rouge&quot;&gt;InFlightTracer()&lt;/code&gt;のような関数がよく使われます．&lt;code class=&quot;highlighter-rouge&quot;&gt;InFlightTracer()&lt;/code&gt;は，現在時刻（&lt;code class=&quot;highlighter-rouge&quot;&gt;Simulator::Now ().GetSeconds ()&lt;/code&gt;）と，更新後の値（&lt;code class=&quot;highlighter-rouge&quot;&gt;inFlight&lt;/code&gt;）を，都度出力する関数です．&lt;/p&gt;

&lt;p&gt;トレース対象とコールバック関数の紐付け時には，上記&lt;code class=&quot;highlighter-rouge&quot;&gt;TraceInFlight()&lt;/code&gt;にあるように，&lt;code class=&quot;highlighter-rouge&quot;&gt;Config::ConnectWithoutContext(variable, MakeCallback(&amp;amp;func))&lt;/code&gt;という構文を使うことができます．ここで，&lt;code class=&quot;highlighter-rouge&quot;&gt;variable&lt;/code&gt;は，トレース対象のObjectのパスを記載する必要があります．&lt;code class=&quot;highlighter-rouge&quot;&gt;/NodeList/1/$$ns3::TcpL4Protocol/SocketList/0/BytesInFlight&lt;/code&gt;は，&lt;code class=&quot;highlighter-rouge&quot;&gt;NodeList&lt;/code&gt;1番のノードにぶら下がる，&lt;code class=&quot;highlighter-rouge&quot;&gt;SocketList&lt;/code&gt;0番のソケットの，変数&lt;code class=&quot;highlighter-rouge&quot;&gt;BytesInFlight&lt;/code&gt;を意味します．&lt;/p&gt;

&lt;p&gt;ns-3におけるトレース方法の詳細は，&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/manual/ns-3-manual.pdf&quot;&gt;公式マニュアル&lt;/a&gt;の1.10節をご参照ください．&lt;/p&gt;

&lt;h3 id=&quot;ネットワーク構成&quot;&gt;ネットワーク構成&lt;/h3&gt;

&lt;p&gt;204行目以降の&lt;code class=&quot;highlighter-rouge&quot;&gt;main()&lt;/code&gt;で，ネットワーク構成の設定を行います．詳細は&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/manual/ns-3-manual.pdf&quot;&gt;公式マニュアル&lt;/a&gt;に譲り，ここではポイントのみ記載します．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/e2b6da86-4058-3ef1-7bba-952887c1d415.png&quot; alt=&quot;network.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;上の図は，本シナリオのイメージ図です．TCP SenderとReceiverがそれぞれ１つずつの，簡単な構成を想定します．FTPライクな大量のデータ送信を模擬する，&lt;code class=&quot;highlighter-rouge&quot;&gt;BulkSendHelper&lt;/code&gt;を利用します．IPパケットサイズは400バイトです．シミュレーション時間は，デフォルトで100秒間です．&lt;/p&gt;

&lt;h3 id=&quot;コマンドライン引数&quot;&gt;コマンドライン引数&lt;/h3&gt;

&lt;p&gt;224行目から243行目で，コマンドライン引数を設定します．&lt;a href=&quot;http://qiita.com/haltaro/items/b474d924f63692c155c8&quot;&gt;前回の記事&lt;/a&gt;でご紹介したように，&lt;code class=&quot;highlighter-rouge&quot;&gt;CommandLine.AddValue()&lt;/code&gt;することで，コマンドライン引数を設定できます．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/f6e8069fd35859f0555a95c40f6536f3.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;本記事では，特に下記のコマンドライン引数を利用します．&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;transport_prot&lt;/code&gt;：輻輳制御アルゴリズムを指定できます．本記事では，シェルスクリプトを使って12種類全てを順番に指定します．&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tracing&lt;/code&gt;：トレーシングの有無を指定できます．デフォルトで&lt;code class=&quot;highlighter-rouge&quot;&gt;False&lt;/code&gt;なので，&lt;code class=&quot;highlighter-rouge&quot;&gt;True&lt;/code&gt;を指定します．&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;duration&lt;/code&gt;：シミュレーション時間を指定できます．デフォルトの100秒は長すぎるので，本記事では20秒に設定します．&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;prefix_name&lt;/code&gt;：出力ファイル名のプレフィックスを指定できます．デフォルト設定だと，&lt;code class=&quot;highlighter-rouge&quot;&gt;~/ns-3.26/source/ns-3.26/&lt;/code&gt;直下に大量のファイルを吐いてしまうので，&lt;code class=&quot;highlighter-rouge&quot;&gt;data&lt;/code&gt;ディレクトリ配下に吐くよう修正します．&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;トレース設定のスケジューリング&quot;&gt;トレース設定のスケジューリング&lt;/h3&gt;

&lt;p&gt;460行目から476行目で，上記&lt;code class=&quot;highlighter-rouge&quot;&gt;TraceInFlight()&lt;/code&gt;等のトレース設定関数（コールバック関数と，トレース対象を紐付ける関数）をスケジューリングします．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/98c58febaadb21dce5713f4014a772d5.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;ns-3では，&lt;code class=&quot;highlighter-rouge&quot;&gt;Simulator::Schedule(time, &amp;amp;func, args,...)&lt;/code&gt;という構文で，&lt;code class=&quot;highlighter-rouge&quot;&gt;time&lt;/code&gt;時に&lt;code class=&quot;highlighter-rouge&quot;&gt;func(args,...)&lt;/code&gt;を実行するようスケジューリングできます．&lt;/p&gt;

&lt;p&gt;しかし，なぜ地の文で&lt;code class=&quot;highlighter-rouge&quot;&gt;Trace*()&lt;/code&gt;してはいけないのか，イマイチよくわからないです．おそらくオブジェクト生成のタイミングの問題の気がするのですが…．&lt;/p&gt;

&lt;h2 id=&quot;tcp-variants-comparisonccの課題&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-variants-comparison.cc&lt;/code&gt;の課題&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-variants-comparison.cc&lt;/code&gt;は，非常によくできたシナリオスクリプトで，コマンドライン引数をいじるだけでかなり遊べます．しかし，我々が興味のある，ACKや輻輳状態をトレースできません！&lt;/p&gt;

&lt;p&gt;幸いにも，最新のACKを表す変数&lt;code class=&quot;highlighter-rouge&quot;&gt;HighestRxAck&lt;/code&gt;と，輻輳状態を表す変数&lt;code class=&quot;highlighter-rouge&quot;&gt;CongState&lt;/code&gt;は，それぞれ&lt;a href=&quot;https://www.nsnam.org/docs/release/3.26/doxygen/tcp-socket-base_8cc.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-socket-base.cc&lt;/code&gt;&lt;/a&gt;で&lt;code class=&quot;highlighter-rouge&quot;&gt;AddTraceSource()&lt;/code&gt;されています．よって，シナリオスクリプトに少し変更を加えるだけで，これらをトレース対象に追加することができます．以下では，その方法をご紹介します．&lt;/p&gt;

&lt;h2 id=&quot;新シナリオスクリプトmy-tcp-variants-comparisoncc&quot;&gt;新シナリオスクリプト&lt;code class=&quot;highlighter-rouge&quot;&gt;my-tcp-variants-comparison.cc&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;まず，もとにする&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-variants-comparison.cc&lt;/code&gt;を&lt;code class=&quot;highlighter-rouge&quot;&gt;~/ns-3.26/source/ns-3.26/scratch&lt;/code&gt;にコピーし，名前を&lt;code class=&quot;highlighter-rouge&quot;&gt;my-tcp-variants-comparison.cc&lt;/code&gt;に変更します．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/7d80b2d4702ca15df1983c5813274a0c.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;ACKと輻輳状態をトレース対象に追加するため，トレース用変数の追加，トレース用コールバック関数の設定，およびトレース設定のスケジューリングを行います．&lt;/p&gt;

&lt;h3 id=&quot;トレース用変数の追加&quot;&gt;トレース用変数の追加&lt;/h3&gt;

&lt;p&gt;ACKトレース用のストリーム&lt;code class=&quot;highlighter-rouge&quot;&gt;ackStream&lt;/code&gt;と，輻輳状態トレース用のストリーム&lt;code class=&quot;highlighter-rouge&quot;&gt;congStateStream&lt;/code&gt;を追加します．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/584452072b9ae54f9ee13e49bc22b0b8.js&quot;&gt;&lt;/script&gt;

&lt;h3 id=&quot;トレース用コールバック関数の設定-1&quot;&gt;トレース用コールバック関数の設定&lt;/h3&gt;

&lt;p&gt;ACKトレース用のコールバック関数&lt;code class=&quot;highlighter-rouge&quot;&gt;AckTrace()&lt;/code&gt;と，輻輳状態トレース用のコールバック関数&lt;code class=&quot;highlighter-rouge&quot;&gt;CongStateTracer()&lt;/code&gt;をそれぞれ追加します．なお，輻輳状態は，&lt;code class=&quot;highlighter-rouge&quot;&gt;tcp-socket-base.h&lt;/code&gt;で定義される列挙型&lt;code class=&quot;highlighter-rouge&quot;&gt;TcpSocketState::TcpCongState_t&lt;/code&gt;です．また，上記のコールバック関数とトレース対象の変数を紐付ける関数&lt;code class=&quot;highlighter-rouge&quot;&gt;TraceAck()&lt;/code&gt;および&lt;code class=&quot;highlighter-rouge&quot;&gt;TraceCongState()&lt;/code&gt;も，それぞれ追加します．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/54113ecb7e3825218f2825c6f4063687.js&quot;&gt;&lt;/script&gt;

&lt;h3 id=&quot;トレース設定のスケジューリング-1&quot;&gt;トレース設定のスケジューリング&lt;/h3&gt;

&lt;p&gt;最後に，上記&lt;code class=&quot;highlighter-rouge&quot;&gt;TraceAck()&lt;/code&gt;および&lt;code class=&quot;highlighter-rouge&quot;&gt;TraceCongState()&lt;/code&gt;をスケジューリングします．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/abfec9ad1f5ad2d836b90bf898af2da4.js&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;my-tcp-variants-comparisonccのコンパイル&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;my-tcp-variants-comparison.cc&lt;/code&gt;のコンパイル&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;~/ns-3.26/source/ns-3.26&lt;/code&gt;ディレクトリで&lt;code class=&quot;highlighter-rouge&quot;&gt;./waf&lt;/code&gt;することで，&lt;code class=&quot;highlighter-rouge&quot;&gt;my-tcp-variants-comparison.cc&lt;/code&gt;をコンパイルできます．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/0c57395712366ea23e2a2e4e5d2c39cb.js&quot;&gt;&lt;/script&gt;

&lt;h1 id=&quot;実験&quot;&gt;実験&lt;/h1&gt;

&lt;h2 id=&quot;シナリオスクリプトの実行&quot;&gt;シナリオスクリプトの実行&lt;/h2&gt;

&lt;p&gt;まず，データ格納用ディレクトリ&lt;code class=&quot;highlighter-rouge&quot;&gt;data&lt;/code&gt;を作成します．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/a925e27e9c66d64e305f05b3604ef560.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;以下のシェルスクリプトを実行して，全12種類のアルゴリズムについて実験を行います．&lt;a href=&quot;http://qiita.com/haltaro/items/b474d924f63692c155c8&quot;&gt;前回の記事&lt;/a&gt;でもご紹介した通り，&lt;code class=&quot;highlighter-rouge&quot;&gt;--arg=value&lt;/code&gt;によりコマンドライン引数&lt;code class=&quot;highlighter-rouge&quot;&gt;arg&lt;/code&gt;に値&lt;code class=&quot;highlighter-rouge&quot;&gt;value&lt;/code&gt;を渡すことができます．&lt;code class=&quot;highlighter-rouge&quot;&gt;transport_prot&lt;/code&gt;は輻輳制御アルゴリズム，&lt;code class=&quot;highlighter-rouge&quot;&gt;prefix_name&lt;/code&gt;は出力ファイル名のプレフィックス，&lt;code class=&quot;highlighter-rouge&quot;&gt;tracing&lt;/code&gt;はトレースの有無，そして&lt;code class=&quot;highlighter-rouge&quot;&gt;duration&lt;/code&gt;はシミュレーション時間[s]を表します．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/9a12ca3b89e92fe0b8d94595fdc049df.js&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;全アルゴリズムの輻輳制御を観察&quot;&gt;全アルゴリズムの輻輳制御を観察&lt;/h2&gt;

&lt;p&gt;ひとまず，下記の&lt;code class=&quot;highlighter-rouge&quot;&gt;plot_cwnd_all_algorithms()&lt;/code&gt;で，全アルゴリズムの&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;と，&lt;script type=&quot;math/tex&quot;&gt;ssth&lt;/script&gt;と，輻輳状態の変化をプロットしてみます．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/8627edf3ad2403b82f1c36e059a26d59.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/cac2dc4a-34fa-5dfd-773e-3dbdb5db7d1e.png&quot; alt=&quot;TcpAll20.0-cwnd.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;横軸は時間[s]，縦軸は&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;および&lt;script type=&quot;math/tex&quot;&gt;ssth&lt;/script&gt;[segment]です．&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;は実線，&lt;script type=&quot;math/tex&quot;&gt;ssth&lt;/script&gt;は点線です．輻輳状態に応じて，色を塗り分けています．&lt;script type=&quot;math/tex&quot;&gt;OPEN&lt;/script&gt;は青，&lt;script type=&quot;math/tex&quot;&gt;DISORDER&lt;/script&gt;は緑，&lt;script type=&quot;math/tex&quot;&gt;RECOVERY&lt;/script&gt;は黄色，そして&lt;script type=&quot;math/tex&quot;&gt;LOSS&lt;/script&gt;は赤です．当初の想定以上に，各アルゴリズムの個性が色濃く出てくれました．&lt;/p&gt;

&lt;h2 id=&quot;各アルゴリズムのcwndackrttの関係を観察&quot;&gt;各アルゴリズムのcwnd，ACK，RTTの関係を観察&lt;/h2&gt;

&lt;p&gt;次は，下記の&lt;code class=&quot;highlighter-rouge&quot;&gt;plot_cwnd_ack_rtt_each_algorithm()&lt;/code&gt;で，各アルゴリズムの&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;，ACK，およびRTTをプロットします．&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/haltaro/9ca7433733a535dbb752b244a5d92a24.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;以下では，NewRenoを例に，結果を分析します．また，ご参考までに，他のアルゴリズムの結果も載せておきます．&lt;/p&gt;

&lt;h3 id=&quot;newreno&quot;&gt;NewReno&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/52b01249-6e2d-33e1-59e6-2de913c81130.png&quot; alt=&quot;TcpNewReno020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;1.93[s]付近で，三重複ACKを受信し，&lt;script type=&quot;math/tex&quot;&gt;RECOVERY&lt;/script&gt;状態に遷移しています．このときのスループットを概算すると：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\begin{align*}
\frac{cwnd}{RTT} \simeq
\frac{321\rm{[segment]} \cdot 340 \rm{[byte/segment] \cdot 8 \rm{[bit/byte]}}}{0.33[s]} \simeq 2.3 \rm{[Mbps]}
\end{align*}&lt;/script&gt;

&lt;p&gt;ここで，ボトルネックリンクの帯域は2.0Mbps（4.1節参照）でしたので，輻輳が発生するタイミングとして不自然ではないです&lt;sup id=&quot;fnref:queue&quot;&gt;&lt;a href=&quot;#fn:queue&quot; class=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;．&lt;script type=&quot;math/tex&quot;&gt;RECOVERY&lt;/script&gt;に遷移後，ACKおよびRTTの更新が止まっていることがわかります．また，&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;や&lt;script type=&quot;math/tex&quot;&gt;ssth&lt;/script&gt;の更新が3.3節と整合していることが確認できます．&lt;/p&gt;

&lt;p&gt;3.26[s]付近で，新規ACKを受信することがないままタイムアウトし，&lt;script type=&quot;math/tex&quot;&gt;LOSS&lt;/script&gt;状態に遷移しています．&lt;script type=&quot;math/tex&quot;&gt;cwnd&lt;/script&gt;や&lt;script type=&quot;math/tex&quot;&gt;ssth&lt;/script&gt;の更新が3.3節と整合していることが確認できます．4.69[s]付近で，ついに新規ACKを受信し，&lt;script type=&quot;math/tex&quot;&gt;OPEN&lt;/script&gt;状態に遷移しています．&lt;/p&gt;

&lt;h3 id=&quot;その他のアルゴリズム&quot;&gt;その他のアルゴリズム&lt;/h3&gt;

&lt;p&gt;ご参考までに，他のアルゴリズムの結果も掲載しておきます．&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/de2ae85a-f79f-0d7a-b98a-90c43e7c97e3.png&quot; alt=&quot;TcpHighSpeed020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/36055b18-bf49-0a50-791e-42929d2c0938.png&quot; alt=&quot;TcpHybla020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/3d41b246-a42d-936e-a3d4-11363c65697c.png&quot; alt=&quot;TcpWestwood020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/400ec59a-a6df-bbe1-9b8f-2ea6c63ee815.png&quot; alt=&quot;TcpWestwoodPlus020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/4ffc8ff4-823f-1aec-3ac1-81eb9469ff76.png&quot; alt=&quot;TcpVegas020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/93ae3515-e91e-92e1-d466-7d800069d95b.png&quot; alt=&quot;TcpScalable020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/6122a656-cd75-c408-6e1a-96cc99573182.png&quot; alt=&quot;TcpVeno020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/e48f2ee4-3aa4-0913-e8d4-bf76a814e439.png&quot; alt=&quot;TcpBic020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/9ed7a220-96ef-7e02-9fff-c9988cfe5a67.png&quot; alt=&quot;TcpYeah020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/f8b06f1b-bee0-9739-0c7d-8a8a0f7ebbfe.png&quot; alt=&quot;TcpIllinois020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/151195/387a0df2-a07b-e756-114d-8a57cdfa761f.png&quot; alt=&quot;TcpHtcp020-cwnd-ack-rtt.png&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;おわりに&quot;&gt;おわりに&lt;/h1&gt;

&lt;p&gt;本記事では，ns-3を使ってTCPの輻輳制御をシミュレートし，pythonで可視化してみました．初心者なりに，TCPの雰囲気を掴むことができました．また，ns-3のサンプルシナリオの優秀さを再認識しました．
　今後は，&lt;a href=&quot;http://dl.acm.org/citation.cfm?id=1400105&quot;&gt;CUBIC&lt;/a&gt;や&lt;a href=&quot;http://www.dcs.gla.ac.uk/~lewis/CTCP.pdf&quot;&gt;CTCP&lt;/a&gt;のようなメジャーなアルゴリズムの実装や，&lt;a href=&quot;http://web.mit.edu/remy/&quot;&gt;Remy&lt;/a&gt;のような最新のアルゴリズムの実装に挑戦したいと思っています．あるいは，異なるアルゴリズム同士の競合を観察してみるのもいいかなと思っています．&lt;/p&gt;

&lt;p&gt;最後まで読んでくださり，ありがとうございました！&lt;/p&gt;

&lt;h1 id=&quot;参考&quot;&gt;参考&lt;/h1&gt;

&lt;p&gt;本記事の作成にあたっては，下記を参考にさせて頂きました．ありがとうございました！&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.net.c.dendai.ac.jp/~yutaro/&quot;&gt;TCP各バージョンの輻輳制御の比較&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www5e.biglobe.ne.jp/aji/3min/42.html&quot;&gt;3分間ネットワーキング，第42回レイヤ４ TCP 輻輳制御&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:congestion&quot;&gt;
      &lt;p&gt;ネットワークにおける混雑，的なイメージの言葉です． &lt;a href=&quot;#fnref:congestion&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:delayedACK&quot;&gt;
      &lt;p&gt;説明をシンプルにするため，本記事では遅延ACK（delayed acknowledgement）は考慮しません．遅延ACKは，複数のACKをまとめて送信することでネットワークの利用効率を向上させる方式です． &lt;a href=&quot;#fnref:delayedACK&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:ACKnumber&quot;&gt;
      &lt;p&gt;Acknowledgement numberは，厳密には受信したSequence number + Segment sizeです．本記事では，説明を直感的にするため，DATAのセグメント番号をそのままACKするようなイメージ図を用いています． &lt;a href=&quot;#fnref:ACKnumber&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:state&quot;&gt;
      &lt;p&gt;いわゆるTCPの状態遷移図（Finite state machine）とは異なります．状態遷移図は，コネクションの確立から切断までを対象としていますが，輻輳状態はコネクション確立（ESTABLISHED）中の輻輳の状態を対象としています． &lt;a href=&quot;#fnref:state&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:queue&quot;&gt;
      &lt;p&gt;たぶん．キューの分析等，もっと詳細な分析が必要だと思いますが力尽きました…． &lt;a href=&quot;#fnref:queue&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 13 Jul 2018 00:00:00 +0900</pubDate>
        <link>http://localhost:4000/2018/07/13/tcp-ns3</link>
        <guid isPermaLink="true">http://localhost:4000/2018/07/13/tcp-ns3</guid>
        
        
        <category>network</category>
        
        <category>ns3</category>
        
        <category>c++</category>
        
        <category>visualization</category>
        
        <category>linux</category>
        
      </item>
    
  </channel>
</rss>
